<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10.7. Non-IP Data Delivery &mdash; Anjay 3.6.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.8. OSCORE" href="CF-OSCORE.html" />
    <link rel="prev" title="10.6. IoT SAFE" href="CF-IoTSAFE.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffd500" >

          
          
          <a href="../index.html">
            
              <img src="../_static/avsystem_header.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.6.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BasicClient.html">4. Basic client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics.html">5. Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FirmwareUpdateTutorial.html">6. Firmware Update Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">7. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PortingGuideForNonPOSIXPlatforms.html">8. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Migrating.html">9. Migrating from older versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../CommercialFeatures.html">10. Commercial features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CF-CorePersistence.html">10.1. Core Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-CustomHardwareSupport.html">10.2. Custom Hardware Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-EST.html">10.3. Enrollment over Secure Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-FSDM.html">10.4. File System Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-HSM.html">10.5. Hardware Security Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-IoTSAFE.html">10.6. IoT SAFE</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.7. Non-IP Data Delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-OSCORE.html">10.8. OSCORE</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-SMSBinding.html">10.9. SMS Binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-SmartCardBootstrap.html">10.10. Bootstrapper and SIM bootstrap</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ffd500" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anjay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../CommercialFeatures.html"><span class="section-number">10. </span>Commercial features</a></li>
      <li class="breadcrumb-item active"><span class="section-number">10.7. </span>Non-IP Data Delivery</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="non-ip-data-delivery">
<h1><span class="section-number">10.7. </span>Non-IP Data Delivery<a class="headerlink" href="#non-ip-data-delivery" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#general-description" id="id1">General description</a></p></li>
<li><p><a class="reference internal" href="#technical-documentation" id="id2">Technical documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#enabling-nidd-support" id="id3">Enabling NIDD support</a></p></li>
<li><p><a class="reference internal" href="#usage-example" id="id4">Usage example</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="general-description">
<h2><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">10.7.1. </span>General description</a><a class="headerlink" href="#general-description" title="Permalink to this heading"></a></h2>
<p>Using Non-IP Data Delivery (NIDD) feature allows for efficient communication
between IoT devices and a LwM2M server. The communication is performed through
the cellular network that ensures security while reducing transmission overhead
required by a classic network stack (IP, TCP and UDP protocols), still
allowing to send up to 1500 bytes in a single transmission. Utilizing an IP
protocol stack for data delivery is considered to be a power hungry process. By
using Non-IP Data Delivery instead, the device can reduce its power consumption.</p>
<p>Non-IP Data Delivery feature provides easy support for different modem devices by
allowing the user to define device wrappers that will be used to communicate
with the hardware. Anjay comes with one implementation of such device wrapper
for the Quectel BG96 modem.</p>
</section>
<section id="technical-documentation">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">10.7.2. </span>Technical documentation</a><a class="headerlink" href="#technical-documentation" title="Permalink to this heading"></a></h2>
<section id="enabling-nidd-support">
<h3><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">10.7.2.1. </span>Enabling NIDD support</a><a class="headerlink" href="#enabling-nidd-support" title="Permalink to this heading"></a></h3>
<p>If Non-IP Data Delivery support is available in your version of Anjay, it can be enabled at
compile time by enabling the <code class="docutils literal notranslate"><span class="pre">ANJAY_WITH_NIDD</span></code> macro in the <code class="docutils literal notranslate"><span class="pre">anjay_config.h</span></code>
file or, if using CMake, enabling the corresponding <code class="docutils literal notranslate"><span class="pre">WITH_NIDD</span></code> CMake option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example in this documentation uses the BG96 wrapper for the NIDD driver
that must be enabled at compile time by setting the <code class="docutils literal notranslate"><span class="pre">ANJAY_WITH_MODULE_BG96_NIDD</span></code>
macro in the <code class="docutils literal notranslate"><span class="pre">anjay_config.h</span></code> file or by using <code class="docutils literal notranslate"><span class="pre">WITH_MODULE_bg96_nidd</span></code> CMake option.</p>
</div>
</section>
<section id="usage-example">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">10.7.2.2. </span>Usage example</a><a class="headerlink" href="#usage-example" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The full code for the following example can be found in the
<code class="docutils literal notranslate"><span class="pre">examples/commercial-features/CF-NIDD</span></code> directory in Anjay sources. Note
that to compile and run it, you need to have access to a commercial version
of Anjay that includes the Non-IP Data Delivery feature.</p>
</div>
<p>In this example we will use a BG96 wrapper for an NIDD driver that is part of Anjay.
To run this example on a Linux-based system you will need to have a
<a class="reference external" href="https://www.quectel.com/product/lpwa-bg96-cat-m1-nb1-egprs">Quectel BG96</a> modem connected
to your PC or utilize the Python script found in <cite>tests/integration/framework/nidd/modem.py</cite>
that will simulate BG96 modem and act as a proxy to connect to a LwM2M server.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Python <cite>modem.py</cite> script creates a pseudo-terminal device which acts like
an AT modem. NIDD network requests generated by Anjay are sent over UDP socket.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To set up the proxy with the Python script run <code class="docutils literal notranslate"><span class="pre">./modem.py</span> <span class="pre">--host</span> <span class="pre">HOST_IP_ADDRESS</span> <span class="pre">--port</span> <span class="pre">PORT_NUMBER</span></code>
command before launching the example. After starting the script it will display
the path of the device that simulates the a BG96 modem.</p>
</div>
<p>Firstly we will introduce a helper function that will open the device associated
with the modem proxy and create an NIDD driver for communication.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="w"> </span><span class="n">anjay_nidd_driver_t</span><span class="w"> </span><span class="o">**</span><span class="nf">demo_nidd_driver_create</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">modem_device</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">     </span><span class="n">demo_nidd_driver_t</span><span class="w"> </span><span class="o">*</span><span class="n">driver</span><span class="w"> </span><span class="o">=</span>
<span class="w">             </span><span class="p">(</span><span class="n">demo_nidd_driver_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">avs_calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">driver</span><span class="p">));</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">driver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_bg96_nidd_config_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="p">.</span><span class="n">system_descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">pts_fd</span><span class="p">,</span>
<span class="w">         </span><span class="p">.</span><span class="n">user_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver</span><span class="p">,</span>
<span class="w">         </span><span class="p">.</span><span class="n">modem_getline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modem_getline</span><span class="p">,</span>
<span class="w">         </span><span class="p">.</span><span class="n">modem_write</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modem_write</span><span class="p">,</span>
<span class="w">         </span><span class="p">.</span><span class="n">modem_get_parameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modem_get_parameter</span>
<span class="w">     </span><span class="p">};</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fifo_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">fifo</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;could not initialize FIFO&quot;</span><span class="p">);</span>
<span class="w">         </span><span class="k">goto</span><span class="w"> </span><span class="n">fail</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">pts_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">modem_device</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;could not open modem device %s: %s&quot;</span><span class="p">,</span>
<span class="w">                 </span><span class="n">modem_device</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
<span class="w">         </span><span class="k">goto</span><span class="w"> </span><span class="n">fail</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">bg96_nidd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anjay_bg96_nidd_driver_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;could not create AT NIDD driver&quot;</span><span class="p">);</span>
<span class="w">         </span><span class="k">goto</span><span class="w"> </span><span class="n">fail</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">bg96_nidd</span><span class="p">;</span>

<span class="w"> </span><span class="nl">fail</span><span class="p">:</span>
<span class="w">     </span><span class="n">driver_cleanup</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If the user does not use the BG96 driver delivered with Anjay, a set of functions
has to be to implemented that will allow communication with the modem device.
More information about the needed functions can be found here:</p>
<ul class="simple">
<li><p><a class="reference external" href="../api/nidd_8h.html">NIDD callback functions</a></p></li>
<li><p><a class="reference external" href="../api/structanjay__nidd__driver__struct.html">NIDD driver structure</a></p></li>
</ul>
</div>
<p>This function calls <code class="docutils literal notranslate"><span class="pre">anjay_bg96_nidd_driver_create(...)</span></code> function that fills
<code class="docutils literal notranslate"><span class="pre">anjay_nidd_driver_t</span></code> structure with callback functions used to integrate with
BG96 modem. The structure with the callback functions containing implementation
of modem integration layer is returned on success. We call this function before
filling <code class="docutils literal notranslate"><span class="pre">anjay_configuration_t</span></code> structure and passing the returned pointer to
<code class="docutils literal notranslate"><span class="pre">.nidd_driver</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;usage: %s ENDPOINT_NAME MODEM_PATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="n">anjay_nidd_driver_t</span><span class="w"> </span><span class="o">**</span><span class="n">demo_nidd_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">demo_nidd_driver_create</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">demo_nidd_driver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Could not create NIDD driver&quot;</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_configuration_t</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="p">.</span><span class="n">endpoint_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="w">         </span><span class="p">.</span><span class="n">in_buffer_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span>
<span class="w">         </span><span class="p">.</span><span class="n">out_buffer_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span>
<span class="w">         </span><span class="p">.</span><span class="n">msg_cache_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span>
<span class="hll"><span class="w">         </span><span class="p">.</span><span class="n">nidd_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">demo_nidd_driver</span>
</span><span class="w">     </span><span class="p">};</span>

<span class="w">     </span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anjay_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONFIG</span><span class="p">);</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">anjay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Could not create Anjay object&quot;</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">     </span><span class="c1">// Setup necessary objects</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">setup_security_object</span><span class="p">(</span><span class="n">anjay</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">setup_server_object</span><span class="p">(</span><span class="n">anjay</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anjay_event_loop_run</span><span class="p">(</span>
<span class="w">                 </span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">avs_time_duration_from_scalar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">AVS_TIME_S</span><span class="p">));</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="n">anjay_delete</span><span class="p">(</span><span class="n">anjay</span><span class="p">);</span>
<span class="w">     </span><span class="n">demo_nidd_driver_cleanup</span><span class="p">(</span><span class="n">demo_nidd_driver</span><span class="p">);</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If <code class="docutils literal notranslate"><span class="pre">nidd_driver</span></code> is not <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, it will enable NIDD transport.
If Anjay configuration used does not support Non-IP Data Delivery feature, setting this to
a non-NULL will cause an error.</p>
</div>
<p>Before calling <code class="docutils literal notranslate"><span class="pre">anjay_event_loop_run</span></code> we need to set up Security and Server objects.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">setup_security_object</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">anjay_security_object_install</span><span class="p">(</span><span class="n">anjay</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_security_instance_t</span><span class="w"> </span><span class="n">security_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="p">.</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="hll"><span class="w">         </span><span class="p">.</span><span class="n">server_uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;coap+nidd://&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="w">         </span><span class="p">.</span><span class="n">security_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ANJAY_SECURITY_NOSEC</span>
</span><span class="w">     </span><span class="p">};</span>

<span class="w">     </span><span class="c1">// Anjay will assign Instance ID automatically</span>
<span class="w">     </span><span class="n">anjay_iid_t</span><span class="w"> </span><span class="n">security_instance_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ANJAY_ID_INVALID</span><span class="p">;</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">anjay_security_object_add_instance</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">security_instance</span><span class="p">,</span>
<span class="w">                                            </span><span class="o">&amp;</span><span class="n">security_instance_id</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="c1">// Installs Server Object and adds and instance of it.</span>
<span class="w"> </span><span class="c1">// An instance of Server Object provides the data related to a LwM2M Server.</span>
<span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">setup_server_object</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">anjay_server_object_install</span><span class="p">(</span><span class="n">anjay</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_server_instance_t</span><span class="w"> </span><span class="n">server_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="c1">// Server Short ID</span>
<span class="w">         </span><span class="p">.</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">         </span><span class="c1">// Client will send Update message often than every 60 seconds</span>
<span class="w">         </span><span class="p">.</span><span class="n">lifetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
<span class="w">         </span><span class="c1">// Disable Default Minimum Period resource</span>
<span class="w">         </span><span class="p">.</span><span class="n">default_min_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">         </span><span class="c1">// Disable Default Maximum Period resource</span>
<span class="w">         </span><span class="p">.</span><span class="n">default_max_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">         </span><span class="c1">// Disable Disable Timeout resource</span>
<span class="w">         </span><span class="p">.</span><span class="n">disable_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="hll"><span class="w">         </span><span class="c1">// Sets preferred transport to NIDD</span>
</span><span class="hll"><span class="w">         </span><span class="p">.</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;N&quot;</span>
</span><span class="w">     </span><span class="p">};</span>

<span class="w">     </span><span class="c1">// Anjay will assign Instance ID automatically</span>
<span class="w">     </span><span class="n">anjay_iid_t</span><span class="w"> </span><span class="n">server_instance_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ANJAY_ID_INVALID</span><span class="p">;</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">anjay_server_object_add_instance</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">server_instance</span><span class="p">,</span>
<span class="w">                                          </span><span class="o">&amp;</span><span class="n">server_instance_id</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Server URI should be set to <code class="docutils literal notranslate"><span class="pre">coap+nidd://</span></code>, security mode should be <code class="docutils literal notranslate"><span class="pre">ANJAY_SECURITY_NOSEC</span></code>
and binding in server object should be set to ‘N’.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CF-IoTSAFE.html" class="btn btn-neutral float-left" title="10.6. IoT SAFE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CF-OSCORE.html" class="btn btn-neutral float-right" title="10.8. OSCORE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, AVSystem.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>