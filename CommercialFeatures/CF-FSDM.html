<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10.4. File System Data Model &mdash; Anjay 3.3.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.5. Hardware Security Module" href="CF-HSM.html" />
    <link rel="prev" title="10.3. Enrollment over Secure Transport" href="CF-EST.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffd500" >
            <a href="../index.html">
            <img src="../_static/avsystem_header.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BasicClient.html">4. Basic client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics.html">5. Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FirmwareUpdateTutorial.html">6. Firmware Update Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">7. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PortingGuideForNonPOSIXPlatforms.html">8. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Migrating.html">9. Migrating from older versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../CommercialFeatures.html">10. Commercial features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CF-CorePersistence.html">10.1. Core Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-CustomHardwareSupport.html">10.2. Custom Hardware Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-EST.html">10.3. Enrollment over Secure Transport</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.4. File System Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-HSM.html">10.5. Hardware Security Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-IoTSAFE.html">10.6. IoT SAFE</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-NIDD.html">10.7. Non-IP Data Delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-OSCORE.html">10.8. OSCORE</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-SMSBinding.html">10.9. SMS Binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-SmartCardBootstrap.html">10.10. Bootstrapper (smart card bootstrap)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ffd500" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anjay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../CommercialFeatures.html"><span class="section-number">10. </span>Commercial features</a> &raquo;</li>
      <li><span class="section-number">10.4. </span>File System Data Model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="file-system-data-model">
<h1><span class="section-number">10.4. </span>File System Data Model<a class="headerlink" href="#file-system-data-model" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#general-description" id="id1">General description</a></p></li>
<li><p><a class="reference internal" href="#supported-features" id="id2">Supported features</a></p></li>
<li><p><a class="reference internal" href="#technical-documentation" id="id3">Technical documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#directory-mapping" id="id4">Directory mapping</a></p></li>
<li><p><a class="reference internal" href="#installing-svetovid" id="id5">Installing Svetovid</a></p></li>
<li><p><a class="reference internal" href="#configuring-svetovid" id="id6">Configuring Svetovid</a></p></li>
<li><p><a class="reference internal" href="#developing-custom-object-example" id="id7">Developing custom object example</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="general-description">
<h2><a class="toc-backref" href="#id1"><span class="section-number">10.4.1. </span>General description</a><a class="headerlink" href="#general-description" title="Permalink to this heading"></a></h2>
<p>File System Data Model feature is implemented in a separate application called
Svetovid that uses Anjay library for communication with a LwM2M server. Svetovid
runs on any Linux-based system what makes it ideal for quick prototyping and
integration with existing infrastructure. File System Data Model is easy
to use. After installing Svetovid LwM2M objects can be represented as scripts
on the file system using any programming language. This allows creating LwM2M
objects without C/C++ programming knowledge. Additionally the File System Data
Model comes with a stub generator for Python and shell script to create a LwM2M
object template.</p>
</section>
<section id="supported-features">
<h2><a class="toc-backref" href="#id2"><span class="section-number">10.4.2. </span>Supported features</a><a class="headerlink" href="#supported-features" title="Permalink to this heading"></a></h2>
<p>The following features are implemented:</p>
<ul class="simple">
<li><p>Mapping of directory on the file system to LwM2M Objects, Instances and Resources</p></li>
<li><p>Handling of multi-instance objects</p></li>
<li><p>FSDM key-value store for keeping volatile object state</p></li>
<li><p>Object stub generator for Python and sh to get started easily</p></li>
</ul>
</section>
<section id="technical-documentation">
<h2><a class="toc-backref" href="#id3"><span class="section-number">10.4.3. </span>Technical documentation</a><a class="headerlink" href="#technical-documentation" title="Permalink to this heading"></a></h2>
<section id="directory-mapping">
<h3><a class="toc-backref" href="#id4"><span class="section-number">10.4.3.1. </span>Directory mapping</a><a class="headerlink" href="#directory-mapping" title="Permalink to this heading"></a></h3>
<p>When enabled, File System Data Model maps a specific directory to LwM2M Objects,
Instances and Resources. Default mapped directory is <code class="docutils literal notranslate"><span class="pre">/etc/svetovid/dm</span></code> but it
can be changed in the <code class="docutils literal notranslate"><span class="pre">/etc/svetovid/config/fsdm.json</span></code> file. The mapped directory
is expected to have the following structure:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/svetovid/dm/</span></code> (default)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$OBJECT_ID/</span></code> - directory representing a LwM2M Object with given ID.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">resources/</span></code> - directory containing scripts used to access individual
Resources.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$RESOURCE_ID</span></code> - executable scripts representing individual Resource
of a given ID.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">instances</span></code> - (optional) executable script used for managing object
instances.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transaction</span></code> - (optional) executable script used to handle
transactional processing of object resources.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="installing-svetovid">
<h3><a class="toc-backref" href="#id5"><span class="section-number">10.4.3.2. </span>Installing Svetovid</a><a class="headerlink" href="#installing-svetovid" title="Permalink to this heading"></a></h3>
<p>To install Svetovid from source and use File System Data Model run those commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./devconfig -DTARGET_PLATFORM<span class="o">=[</span>TARGET<span class="o">]</span>
$ make
$ sudo make install
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use “generic” as <code class="docutils literal notranslate"><span class="pre">TARGET</span></code> to compile Svetovid on a standard Linux distribution.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that this installs a <code class="docutils literal notranslate"><span class="pre">svetovid.service</span></code> systemd service, automatically
enabled, and starts-up the Client immediately. You may want to disable the
service using systemctl command.</p>
</div>
</section>
<section id="configuring-svetovid">
<h3><a class="toc-backref" href="#id6"><span class="section-number">10.4.3.3. </span>Configuring Svetovid</a><a class="headerlink" href="#configuring-svetovid" title="Permalink to this heading"></a></h3>
<p>Svetovid is configured using JSONs files. The default location of those JSONs is
<code class="docutils literal notranslate"><span class="pre">/etc/svetovid/config</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Default configuration directory may be overwritten by passing <code class="docutils literal notranslate"><span class="pre">--conf-dir</span></code> as
a command line argument when starting a Svetovid binary.</p>
</div>
<p>The configuration is stored in those files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">security.json</span></code> - represents the Security LwM2M object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">server.json</span></code> - represents the Server LwM2M object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">svd.json</span></code> - global settings</p></li>
</ul>
<p>Example of <code class="docutils literal notranslate"><span class="pre">security.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;server_uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coaps://eu.iot.avsystem.cloud:5684&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;security_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;psk&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;pubkey_or_identity_hex&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6d7a2d737665746f766964&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;privkey_or_psk_hex&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;737665746f76696431323334&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;ssid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;is_bootstrap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Example of <code class="docutils literal notranslate"><span class="pre">server.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;0&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;ssid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;lifetime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;binding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;U&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Example of <code class="docutils literal notranslate"><span class="pre">svd.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;endpoint_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;svetovid-example&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;logging&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;default_log_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;log_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nt">&quot;svd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;debug&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;in_buffer_size_b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10240</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;out_buffer_size_b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10240</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;msg_cache_size_b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">65536</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For detailed description of configuration files format please refer to the
full documentation.</p>
</div>
</section>
<section id="developing-custom-object-example">
<h3><a class="toc-backref" href="#id7"><span class="section-number">10.4.3.4. </span>Developing custom object example</a><a class="headerlink" href="#developing-custom-object-example" title="Permalink to this heading"></a></h3>
<p>After installation Svetovid is run as a service and can be controlled by
systemctl</p>
<p>To implement a Time Object (/3333) you can start by generating a stub</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo svetovid-fsdmtool generate --object <span class="m">3333</span> --output-dir /etc/svetovid/dm --generator python
</pre></div>
</div>
<p>This will create <code class="docutils literal notranslate"><span class="pre">/etc/svetovid/dm/3333</span></code> directory containing Python scripts
that represent LwM2M resources. The hierarchy of the filesystem mapped to a LwM2M
object is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/etc/svetovid/dm/3333
├── Application_Type -&gt; resources/5750
├── Current_Time -&gt; resources/5506
├── Fractional_Time -&gt; resources/5507
├── instances
├── Measurement_Quality_Indicator -&gt; resources/6042
├── Measurement_Quality_Level -&gt; resources/6049
└── resources
    ├── <span class="m">5506</span>
    ├── <span class="m">5507</span>
    ├── <span class="m">5750</span>
    ├── <span class="m">6042</span>
    └── <span class="m">6049</span>
</pre></div>
</div>
<p>The scripts generated this way contain placeholders for the <code class="docutils literal notranslate"><span class="pre">read</span></code>, <code class="docutils literal notranslate"><span class="pre">write</span></code>
and <code class="docutils literal notranslate"><span class="pre">reset</span></code> functions that need to be filled out by the user. For example
the <code class="docutils literal notranslate"><span class="pre">Fraction</span> <span class="pre">Time</span></code> (/3333/*/5507) resource can be implemented as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- encoding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">fsdm</span> <span class="kn">import</span> <span class="n">ResourceHandler</span><span class="p">,</span> <span class="n">CoapError</span><span class="p">,</span> <span class="n">DataType</span><span class="p">,</span> <span class="n">KvStore</span>


<span class="k">class</span> <span class="nc">ResourceHandler_3333_5506</span><span class="p">(</span><span class="n">ResourceHandler</span><span class="p">):</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;Current Time&quot;</span>
    <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">Unix Time. A signed integer representing the number of seconds since</span>
<span class="s1"> * Jan 1st, 1970 in the UTC time zone.&#39;&#39;&#39;</span>
    <span class="n">DATATYPE</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">TIME</span>
    <span class="n">EXTERNAL_NOTIFY</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">instance_id</span><span class="p">,</span>            <span class="c1"># int</span>
             <span class="n">resource_instance_id</span><span class="p">):</span>  <span class="c1"># int for multiple resources, None otherwise</span>
        <span class="c1"># It&#39;s just that simple!</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>


    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">instance_id</span><span class="p">,</span>            <span class="c1"># int</span>
              <span class="n">resource_instance_id</span><span class="p">):</span>  <span class="c1"># int for multiple resources, None otherwise</span>
        <span class="c1"># NOTE: Implement this if you want to be able to change time on your system.</span>
        <span class="k">raise</span> <span class="n">CoapError</span><span class="o">.</span><span class="n">NOT_IMPLEMENTED</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">instance_id</span><span class="p">):</span>  <span class="c1"># int</span>
        <span class="c1"># NOTE: reset resource to its original state. You can either set it to</span>
        <span class="c1"># a default value or delete the resource.</span>
        <span class="k">pass</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ResourceHandler_3333_5506</span><span class="p">()</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>To implement <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Type</span></code> resource (/3333/*/5750) we can use a simple
implementation of a key-value store which is accessible from Python via <code class="docutils literal notranslate"><span class="pre">KvStore</span></code>
class. The class implements a simple interface:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">KvStore(namespace)</span></code> - constructor that takes <code class="docutils literal notranslate"><span class="pre">namespace</span></code> as an argument.
This can be set as anything as long as it can be uniquely distinguished between different
objects. A good idea is to use an Object ID as a <code class="docutils literal notranslate"><span class="pre">namespace</span></code> used by the <code class="docutils literal notranslate"><span class="pre">KvStore</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get(key,</span> <span class="pre">default=None)</span></code> - method for getting a value for a given <code class="docutils literal notranslate"><span class="pre">key</span></code>.
If the value is not present it will return the <code class="docutils literal notranslate"><span class="pre">default</span></code> value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set(key,</span> <span class="pre">value)</span></code> - method for setting a <code class="docutils literal notranslate"><span class="pre">value</span></code> for a given <code class="docutils literal notranslate"><span class="pre">key</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete(key)</span></code> - method for deleting a <code class="docutils literal notranslate"><span class="pre">key</span></code> with associated value from
the <code class="docutils literal notranslate"><span class="pre">KvStore</span></code>.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- encoding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">fsdm</span> <span class="kn">import</span> <span class="n">ResourceHandler</span><span class="p">,</span> <span class="n">CoapError</span><span class="p">,</span> <span class="n">DataType</span><span class="p">,</span> <span class="n">KvStore</span>

<span class="kn">import</span> <span class="nn">sys</span> <span class="c1"># for sys.stdout.write() and sys.stdin.read()</span>

<span class="k">class</span> <span class="nc">ResourceHandler_3333_5750</span><span class="p">(</span><span class="n">ResourceHandler</span><span class="p">):</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;Application Type&quot;</span>
    <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">The application type of the sensor or actuator as a string depending</span>
<span class="s1"> * on the use case.&#39;&#39;&#39;</span>
    <span class="n">DATATYPE</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">STRING</span>
    <span class="n">EXTERNAL_NOTIFY</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">instance_id</span><span class="p">,</span>            <span class="c1"># int</span>
             <span class="n">resource_instance_id</span><span class="p">):</span>  <span class="c1"># int for multiple resources, None otherwise</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">KvStore</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="mi">3333</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;application_type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The value was not set, so it&#39;s not found.</span>
            <span class="k">raise</span> <span class="n">CoapError</span><span class="o">.</span><span class="n">NOT_FOUND</span>

        <span class="c1"># The value is present within the store, thus we can print it on stdout.</span>
        <span class="c1"># The important thing here is to remember to return string-typed resources</span>
        <span class="c1"># with sys.stdout.write(), as print() adds unnecessary newline character, so</span>
        <span class="c1"># if we used it instead, the value presented to the server would contain that</span>
        <span class="c1"># trailing newline character.</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">instance_id</span><span class="p">,</span>            <span class="c1"># int</span>
              <span class="n">resource_instance_id</span><span class="p">):</span>  <span class="c1"># int for multiple resources, None otherwise</span>
        <span class="c1"># All we need to do is to assign a value to the application_type key.</span>
        <span class="n">KvStore</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="mi">3333</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;application_type&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">instance_id</span><span class="p">):</span>  <span class="c1"># int</span>
        <span class="c1"># We reset the resource to its original state by simply deleting the application_type</span>
        <span class="c1"># key</span>
        <span class="n">KvStore</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="mi">3333</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;application_type&#39;</span><span class="p">)</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ResourceHandler_3333_5750</span><span class="p">()</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CF-EST.html" class="btn btn-neutral float-left" title="10.3. Enrollment over Secure Transport" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CF-HSM.html" class="btn btn-neutral float-right" title="10.5. Hardware Security Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, AVSystem.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>