<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10.10. Bootstrapper (smart card bootstrap) &mdash; Anjay 3.3.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="10.9. SMS Binding" href="CF-SMSBinding.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffd500" >
            <a href="../index.html">
            <img src="../_static/avsystem_header.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BasicClient.html">4. Basic client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics.html">5. Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FirmwareUpdateTutorial.html">6. Firmware Update Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">7. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PortingGuideForNonPOSIXPlatforms.html">8. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Migrating.html">9. Migrating from older versions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../CommercialFeatures.html">10. Commercial features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CF-CorePersistence.html">10.1. Core Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-CustomHardwareSupport.html">10.2. Custom Hardware Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-EST.html">10.3. Enrollment over Secure Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-FSDM.html">10.4. File System Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-HSM.html">10.5. Hardware Security Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-IoTSAFE.html">10.6. IoT SAFE</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-NIDD.html">10.7. Non-IP Data Delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-OSCORE.html">10.8. OSCORE</a></li>
<li class="toctree-l2"><a class="reference internal" href="CF-SMSBinding.html">10.9. SMS Binding</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.10. Bootstrapper (smart card bootstrap)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ffd500" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anjay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../CommercialFeatures.html"><span class="section-number">10. </span>Commercial features</a> &raquo;</li>
      <li><span class="section-number">10.10. </span>Bootstrapper (smart card bootstrap)</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bootstrapper-smart-card-bootstrap">
<h1><span class="section-number">10.10. </span>Bootstrapper (smart card bootstrap)<a class="headerlink" href="#bootstrapper-smart-card-bootstrap" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#general-description" id="id2">General description</a></p></li>
<li><p><a class="reference internal" href="#technical-documentation" id="id3">Technical documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#enabling-the-bootstrapper-module" id="id4">Enabling the bootstrapper module</a></p></li>
<li><p><a class="reference internal" href="#bootstrap-information-generator-tool" id="id5">Bootstrap information generator tool</a></p></li>
<li><p><a class="reference internal" href="#example-code" id="id6">Example code</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="general-description">
<h2><a class="toc-backref" href="#id2"><span class="section-number">10.10.1. </span>General description</a><a class="headerlink" href="#general-description" title="Permalink to this heading"></a></h2>
<p>The LwM2M specification defines <a class="reference external" href="http://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/HTML-Version/OMA-TS-LightweightM2M_Core-V1_1_1-20190617-A.html#6-1-3-2-0-6132-Bootstrap-from-Smartcard">Bootstrap from Smartcard</a>,
a mode of bootstrapping the device where the initial Bootstrap Information is
stored on a smart card - typically the SIM card in case of devices that use
cellular connectivity.</p>
<p>Standard file formats for this bootstrap information and related metadata are
defined in <a class="reference external" href="http://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/HTML-Version/OMA-TS-LightweightM2M_Core-V1_1_1-20190617-A.html#15-0-Appendix-G-Storage-of-LwM2M-Bootstrap-Information-on-the-Smartcard-Normative">Appendix G</a>,
of the LwM2M Technical Specification, and specifications for the secure channel
between Smartcard and LwM2M Device Storage in <a class="reference external" href="http://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/HTML-Version/OMA-TS-LightweightM2M_Core-V1_1_1-20190617-A.html#16-0-Appendix-H-Secure-channel-between-Smartcard-and-LwM2M-Device-Storage-for-secure-Bootstrap-Data-provisioning-Normative">Appendix H</a>
thereof.</p>
<p>While communicating with the smart card is considered outside the scope for the
Anjay library, the “bootstrapper” feature, available commercially, implements a
parser for the file format described in <a class="reference external" href="http://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/HTML-Version/OMA-TS-LightweightM2M_Core-V1_1_1-20190617-A.html#15-3-4-0-G34-EF-LwM2M_Bootstrap">section G.3.4 of the Appendix G</a>
mentioned above.</p>
<p>Bootstrapping from smart card has a number of advantages, including:</p>
<ul class="simple">
<li><p>Ability to store bootstrap information securely, increasing the device’s
resilience against tampering</p></li>
<li><p>Possibility to remotely update bootstrap information using cellular
infrastructure, without the need for a full firmware upgrade</p></li>
<li><p>For devices controlled by cellular carriers - ability to control the bootstrap
information without contacting the device manufacturer</p></li>
</ul>
</section>
<section id="technical-documentation">
<h2><a class="toc-backref" href="#id3"><span class="section-number">10.10.2. </span>Technical documentation</a><a class="headerlink" href="#technical-documentation" title="Permalink to this heading"></a></h2>
<section id="enabling-the-bootstrapper-module">
<span id="cf-smart-card-bootstrap-enabling"></span><h3><a class="toc-backref" href="#id4"><span class="section-number">10.10.2.1. </span>Enabling the bootstrapper module</a><a class="headerlink" href="#enabling-the-bootstrapper-module" title="Permalink to this heading"></a></h3>
<p>If the bootstrapper feature is available in your version of Anjay, it can be
enabled at compile time by enabling the <code class="docutils literal notranslate"><span class="pre">ANJAY_WITH_MODULE_BOOTSTRAPPER</span></code> macro
in the <code class="docutils literal notranslate"><span class="pre">anjay_config.h</span></code> file or, if using CMake, enabling the corresponding
<code class="docutils literal notranslate"><span class="pre">WITH_MODULE_bootstrapper</span></code> CMake option.</p>
<p>When this feature is enabled, the <a class="reference external" href="../api/bootstrapper_8h.html#a9763a2328433e93ae5121f0b218b43a1">anjay_bootstrapper()</a> function can
be used. The user will need to provide an implementation of <code class="docutils literal notranslate"><span class="pre">avs_stream_t</span></code>
that allows the Anjay code to read the file contained on the smartcard. The
<code class="docutils literal notranslate"><span class="pre">avs_stream_simple_input_create()</span></code> function from the <a class="reference external" href="https://github.com/AVSystem/avs_commons/blob/master/include_public/avsystem/commons/avs_stream_simple_io.h">avs_stream_simple_io.h</a>
header is likely to be the easiest way to provide such an implementation.</p>
</section>
<section id="bootstrap-information-generator-tool">
<h3><a class="toc-backref" href="#id5"><span class="section-number">10.10.2.2. </span>Bootstrap information generator tool</a><a class="headerlink" href="#bootstrap-information-generator-tool" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">generator.py</span></code> application, located in the <code class="docutils literal notranslate"><span class="pre">bootstrap</span></code> directory of
Anjay source package, allows generating binary files in the EF LwM2M_Bootstrap
format that is supposed to be stored on smart cards, from a human-readable text
file format.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">generator.py</span></code> script, by default, processes the standard input and
outputs to the standard output. However, an input file may be specified using
the <cite>-c</cite> option, and the output file may be specified using the <code class="docutils literal notranslate"><span class="pre">-o</span></code> option.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The generator script is <strong>NOT</strong> intended to be safe to use with arbitrary
input data. It is only intended for convenience when working with files
created locally by trusted parties.</p>
<p><strong>The input text files are evaluated as Python code</strong>, and as such, running
the generator script with untrusted input may lead to arbitrary operations
being performed on the computer.</p>
</div>
<p>The input file shall specify a dictionary according to Python syntax where:</p>
<ul class="simple">
<li><p>On the top level, the keys shall be Object IDs, and the values shall be nested
dictionaries describing the objects.</p></li>
<li><p>On the Object level, the keys shall be Instance IDs, and the values shall be
nested dictionaries describing the instances.</p></li>
<li><p>On the Object Instance level, the keys shall be Resource IDs, and the values
shall be either of:</p>
<ul>
<li><p>Primitive types (numbers, booleans, strings or <code class="docutils literal notranslate"><span class="pre">bytes</span></code> objects) for
single-instance resources</p></li>
<li><p>Lists of pairs (tuples of length 2) for Multiple-Instance Resources - in
that case the first pair element shall be the Resource Instance ID, and the
second one shall be the value of a primitive type</p></li>
</ul>
</li>
</ul>
<p>The constants from the <code class="docutils literal notranslate"><span class="pre">OID</span></code> and <code class="docutils literal notranslate"><span class="pre">RID</span></code> objects, as defined in the
<a class="reference external" href="https://github.com/AVSystem/Anjay/blob/master/tests/integration/framework/test_utils.py">tests/integration/framework/test_utils.py</a>
file, may be used to make the keys more descriptive, as in the example input
file (<code class="docutils literal notranslate"><span class="pre">bootstrap/configs/basic</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">OID</span><span class="o">.</span><span class="n">Security</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">ServerURI</span>          <span class="p">:</span> <span class="s1">&#39;coaps://eu.iot.avsystem.cloud:5684&#39;</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Bootstrap</span>          <span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Mode</span>               <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># PSK</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">PKOrIdentity</span>       <span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;example-psk-identity&#39;</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">SecretKey</span>          <span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;3x@mpl3P5K53cr3tK3y&#39;</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">ShortServerID</span>      <span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="n">OID</span><span class="o">.</span><span class="n">Server</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Server</span><span class="o">.</span><span class="n">ShortServerID</span>        <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Server</span><span class="o">.</span><span class="n">Lifetime</span>             <span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Server</span><span class="o">.</span><span class="n">NotificationStoring</span>  <span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">.</span><span class="n">Server</span><span class="o">.</span><span class="n">Binding</span>              <span class="p">:</span> <span class="s1">&#39;U&#39;</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example is equivalent to the following data written only using
primitive values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;coaps://eu.iot.avsystem.cloud:5684&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;example-psk-identity&#39;</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;3x@mpl3P5K53cr3tK3y&#39;</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;U&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following example shell session illustrates the way of generating the
binary bootstrap information file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>~/projects/anjay/bootstrap$ ./generator.py -c configs/basic -o basic_config.dat
~/projects/anjay/bootstrap$ hexdump -C basic_config.dat
00000000  00 02 00 7a 00 00 00 00  5e 08 01 5b c8 00 22 63  |...z....^..[..&quot;c|
00000010  6f 61 70 73 3a 2f 2f 65  75 2e 69 6f 74 2e 61 76  |oaps://eu.iot.av|
00000020  73 79 73 74 65 6d 2e 63  6c 6f 75 64 3a 35 36 38  |system.cloud:568|
00000030  34 c1 01 00 c1 02 00 c8  03 14 65 78 61 6d 70 6c  |4.........exampl|
00000040  65 2d 70 73 6b 2d 69 64  65 6e 74 69 74 79 c8 05  |e-psk-identity..|
00000050  13 33 78 40 6d 70 6c 33  50 35 4b 35 33 63 72 33  |.3x@mpl3P5K53cr3|
00000060  74 4b 33 79 c1 0a 01 00  01 00 00 12 08 01 0f c1  |tK3y............|
00000070  00 01 c4 01 00 01 51 80  c1 06 00 c1 07 55        |......Q......U|
0000007e
</pre></div>
</div>
</section>
<section id="example-code">
<h3><a class="toc-backref" href="#id6"><span class="section-number">10.10.2.3. </span>Example code</a><a class="headerlink" href="#example-code" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The full code for the following example can be found in the
<code class="docutils literal notranslate"><span class="pre">examples/commercial-features/CF-SmartCardBootstrap</span></code> directory in Anjay
sources. Note that to compile and run it, you need to have access to a
commercial version of Anjay that includes the bootstrapper feature.</p>
</div>
<p>The example is loosely based on the <a class="reference internal" href="../BasicClient/BC-MandatoryObjects.html"><span class="doc">Installing mandatory Objects</span></a>
tutorial. However, since the bootstrap information will be loaded from a file,
the <code class="docutils literal notranslate"><span class="pre">setup_security_object()</span></code> and <code class="docutils literal notranslate"><span class="pre">setup_server_object()</span></code> functions are no
longer necessary, and the calls to them can be replaced with direct calls to
<a class="reference external" href="../api/security_8h.html#a5fffaeedfc5c2933e58ac1446fd0401d">anjay_security_object_install()</a> and
<a class="reference external" href="../api/server_8h.html#a36a369c0d7d1b2ad42c898ac47b75765">anjay_server_object_install()</a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;usage: %s ENDPOINT_NAME BOOTSTRAP_INFO_FILE&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_configuration_t</span><span class="w"> </span><span class="n">CONFIG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">endpoint_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">in_buffer_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">out_buffer_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">msg_cache_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anjay_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONFIG</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">anjay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Could not create Anjay object&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Setup necessary objects</span>
<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">anjay_security_object_install</span><span class="p">(</span><span class="n">anjay</span><span class="p">)</span><span class="w"></span>
</span><span class="hll"><span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="n">anjay_server_object_install</span><span class="p">(</span><span class="n">anjay</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="hll"><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bootstrap_from_file</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anjay_event_loop_run</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">avs_time_duration_from_scalar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">AVS_TIME_S</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">anjay_delete</span><span class="p">(</span><span class="n">anjay</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>As you can see, the command line now expects a second argument with a name of
the file containing the bootstrap information.</p>
<p>This file is loaded using the <code class="docutils literal notranslate"><span class="pre">bootstrap_from_file()</span></code> function, implemented as
follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">bootstrap_from_file</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Attempting to bootstrap from file&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">avs_stream_t</span><span class="w"> </span><span class="o">*</span><span class="n">file_stream</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">            </span><span class="n">avs_stream_file_create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">AVS_STREAM_FILE_READ</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file_stream</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Could not open file&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">avs_is_err</span><span class="p">(</span><span class="n">anjay_bootstrapper</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">file_stream</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">avs_log</span><span class="p">(</span><span class="n">tutorial</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Could not bootstrap from file&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">avs_stream_cleanup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_stream</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This shares similarities with the <code class="docutils literal notranslate"><span class="pre">restore_objects_if_possible()</span></code> function
from the <a class="reference internal" href="../AdvancedTopics/AT-Persistence.html"><span class="doc">Persistence support</span></a> tutorial.</p>
<p>As mentioned in the <a class="reference internal" href="#cf-smart-card-bootstrap-enabling"><span class="std std-ref">Enabling the bootstrapper module</span></a> section above, to
perform bootstrap using an actual smart card, the
<code class="docutils literal notranslate"><span class="pre">avs_stream_simple_input_create()</span></code> function from the <a class="reference external" href="https://github.com/AVSystem/avs_commons/blob/master/include_public/avsystem/commons/avs_stream_simple_io.h">avs_stream_simple_io.h</a>
header could be used instead of the <code class="docutils literal notranslate"><span class="pre">avs_stream_file_create()</span></code> call that is
used here to access regular file system.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CF-SMSBinding.html" class="btn btn-neutral float-left" title="10.9. SMS Binding" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, AVSystem.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>