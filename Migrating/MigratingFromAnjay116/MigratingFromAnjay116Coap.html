

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>9.1.2. Replacement of CoAP implementation &mdash; Anjay 2.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9.1.3. Changes in avs_commons" href="MigratingFromAnjay116Commons.html" />
    <link rel="prev" title="9.1.1. Changes in Anjay proper" href="MigratingFromAnjay116Anjay.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffd500" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/avsystem_header.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BasicClient.html">4. Basic client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AdvancedTopics.html">5. Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FirmwareUpdateTutorial.html">6. Firmware Update Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">7. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PortingGuideForNonPOSIXPlatforms.html">8. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Migrating.html">9. Migrating from older versions</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../MigratingFromAnjay116.html">9.1. Migrating from Anjay 1.16</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="MigratingFromAnjay116Anjay.html">9.1.1. Changes in Anjay proper</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">9.1.2. Replacement of CoAP implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="MigratingFromAnjay116Commons.html">9.1.3. Changes in avs_commons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../MigratingFromAnjay225.html">9.2. Migrating from Anjay 2.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../MigratingCustomEntropy.html">9.3. Migrating mbed TLS custom entropy initializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../MigratingFromAnjay24.html">9.4. Migrating from Anjay 2.3.x or 2.4.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../MigratingFromAnjay26.html">9.5. Migrating from Anjay 2.5.x or 2.6.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../MigratingFromAnjay27.html">9.6. Migrating from Anjay 2.7.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../MigratingFromAnjay28.html">9.7. Migrating from Anjay 2.8.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Commercial_support.html">10. Commercial support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Anjay</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../Migrating.html"><span class="section-number">9. </span>Migrating from older versions</a> &raquo;</li>
        
          <li><a href="../MigratingFromAnjay116.html"><span class="section-number">9.1. </span>Migrating from Anjay 1.16</a> &raquo;</li>
        
      <li><span class="section-number">9.1.2. </span>Replacement of CoAP implementation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="replacement-of-coap-implementation">
<h1><span class="section-number">9.1.2. </span>Replacement of CoAP implementation<a class="headerlink" href="#replacement-of-coap-implementation" title="Permalink to this headline">¶</a></h1>
<p>Anjay 2.x uses a completely new CoAP implementation called <code class="docutils literal notranslate"><span class="pre">avs_coap</span></code>. The old
CoAP component of <code class="docutils literal notranslate"><span class="pre">avs_commons</span></code> has been removed in since <code class="docutils literal notranslate"><span class="pre">avs_commons</span></code> 4.1
and Anjay 2.3. If your code used the raw CoAP APIs of that component, you will
need to migrate to either the new <code class="docutils literal notranslate"><span class="pre">avs_coap</span></code> library or an entirely different
CoAP implementation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The new <code class="docutils literal notranslate"><span class="pre">avs_coap</span></code> library has a higher-level API, designed to abstract
away the differences between e.g. UDP and TCP transports. Some of the
functionality of the legacy library, especially that related to parsing,
serializing, sending and receiving raw, isolated messages (as opposed to
proper, conformant CoAP exchanges), is not provided in the public API for
this reason.</p>
</div>
<div class="section" id="udp-transmission-parameters-type">
<h2><span class="section-number">9.1.2.1. </span>UDP transmission parameters type<a class="headerlink" href="#udp-transmission-parameters-type" title="Permalink to this headline">¶</a></h2>
<p>In Anjay configuration, whenever the CoAP/UDP transmission parameters has to be
specified, the new <code class="docutils literal notranslate"><span class="pre">avs_coap_udp_tx_params_t</span></code> type replaces the
<code class="docutils literal notranslate"><span class="pre">avs_coap_tx_params_t</span></code> type from the old CoAP implementation.</p>
<ul>
<li><p><strong>Old API:</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** CoAP transmission params object. */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="cm">/** RFC 7252: ACK_TIMEOUT */</span>
    <span class="n">avs_time_duration_t</span> <span class="n">ack_timeout</span><span class="p">;</span>
    <span class="cm">/** RFC 7252: ACK_RANDOM_FACTOR */</span>
    <span class="kt">double</span> <span class="n">ack_random_factor</span><span class="p">;</span>
    <span class="cm">/** RFC 7252: MAX_RETRANSMIT */</span>
    <span class="kt">unsigned</span> <span class="n">max_retransmit</span><span class="p">;</span>
<span class="p">}</span> <span class="n">avs_coap_tx_params_t</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p><strong>New API:</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** CoAP transmission params object. */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="cm">/** RFC 7252: ACK_TIMEOUT */</span>
    <span class="n">avs_time_duration_t</span> <span class="n">ack_timeout</span><span class="p">;</span>
    <span class="cm">/** RFC 7252: ACK_RANDOM_FACTOR */</span>
    <span class="kt">double</span> <span class="n">ack_random_factor</span><span class="p">;</span>
    <span class="cm">/** RFC 7252: MAX_RETRANSMIT */</span>
    <span class="kt">unsigned</span> <span class="n">max_retransmit</span><span class="p">;</span>
    <span class="cm">/** RFC 7252: NSTART */</span>
    <span class="kt">size_t</span> <span class="n">nstart</span><span class="p">;</span>
<span class="p">}</span> <span class="n">avs_coap_udp_tx_params_t</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the <code class="docutils literal notranslate"><span class="pre">ack_timeout</span></code>, <code class="docutils literal notranslate"><span class="pre">ack_random_factor</span></code> and <code class="docutils literal notranslate"><span class="pre">max_retransmit</span></code>
fields have equivalent semantics, <strong>the new</strong> <code class="docutils literal notranslate"><span class="pre">nstart</span></code> <strong>field has a
default value of</strong> <code class="docutils literal notranslate"><span class="pre">1</span></code>, <strong>and it is not allowed to leave it as</strong> <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Support for <code class="docutils literal notranslate"><span class="pre">nstart</span></code> values other than <code class="docutils literal notranslate"><span class="pre">1</span></code> in Anjay and <code class="docutils literal notranslate"><span class="pre">avs_coap</span></code> is
considered experimental.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="MigratingFromAnjay116Commons.html" class="btn btn-neutral float-right" title="9.1.3. Changes in avs_commons" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="MigratingFromAnjay116Anjay.html" class="btn btn-neutral float-left" title="9.1.1. Changes in Anjay proper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017-2021, AVSystem

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>