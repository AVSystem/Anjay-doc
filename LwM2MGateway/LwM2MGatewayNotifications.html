<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.3. Observe and Notify support for LwM2M Gateway EIDs &mdash; Anjay 3.9.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=86f27845" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=554064f1" />

  
  
        <script src="../_static/jquery.js?v=8dae8fb0"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=e55a5be6"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.4. Send method for LwM2M Gateway EIDs" href="LwM2MGatewaySend.html" />
    <link rel="prev" title="7.2. LwM2M Gateway API" href="LwM2MGatewayAPI.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffd500" >

          
          
          <a href="../index.html">
            
              <img src="../_static/avsystem_header.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.9.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BasicClient.html">4. Basic client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics.html">5. Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FirmwareUpdateTutorial.html">6. Firmware Update Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../LwM2MGateway.html">7. LwM2M Gateway</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="LwM2MGatewayIntro.html">7.1. LwM2M Gateway Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="LwM2MGatewayAPI.html">7.2. LwM2M Gateway API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.3. Observe and Notify support for LwM2M Gateway EIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="LwM2MGatewaySend.html">7.4. Send method for LwM2M Gateway EIDs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">8. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PortingGuideForNonPOSIXPlatforms.html">9. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Migrating.html">10. Migrating from older versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CommercialFeatures.html">11. Commercial features</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ffd500" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anjay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../LwM2MGateway.html"><span class="section-number">7. </span>LwM2M Gateway</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7.3. </span>Observe and Notify support for LwM2M Gateway EIDs</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="observe-and-notify-support-for-lwm2m-gateway-eids">
<h1><span class="section-number">7.3. </span>Observe and Notify support for LwM2M Gateway EIDs<a class="headerlink" href="#observe-and-notify-support-for-lwm2m-gateway-eids" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#how-observe-notify-works" id="id2">How Observe/Notify works</a></p></li>
<li><p><a class="reference internal" href="#observe-notify-for-lwm2m-gateway-eids" id="id3">Observe/Notify for LwM2M Gateway EIDs</a></p></li>
<li><p><a class="reference internal" href="#optimizing-notifications-for-eids" id="id4">Optimizing notifications for EIDs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#example" id="id5">Example</a></p>
<ul>
<li><p><a class="reference internal" href="#cache-mechanism" id="id6">Cache mechanism</a></p></li>
<li><p><a class="reference internal" href="#resource-refresh-mechanism" id="id7">Resource refresh mechanism</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#conclusion" id="id8">Conclusion</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">7.3.1. </span>Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>LwM2M <strong>Observe/Notify</strong> operations allow a server to receive updates on
resource values whenever they change or meet specific conditions. In <strong>Anjay</strong>,
it is the user’s responsibility to keep resource states up to date for
observations and to notify the library about state changes not triggered by
Write or Create operations.</p>
<p>To ensure that the LwM2M client meets the observation attributes configured
by the server, resource states must be updated frequently enough.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re unfamiliar with the <strong>LwM2M Observe/Notify</strong> mechanism and its
use in Anjay for standard LwM2M clients, read the
<a class="reference internal" href="../BasicClient/BC-Notifications.html"><span class="doc">Notifications support</span></a> tutorial first.</p>
</div>
<section id="how-observe-notify-works">
<h3><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">7.3.1.1. </span>How Observe/Notify works</a><a class="headerlink" href="#how-observe-notify-works" title="Link to this heading"></a></h3>
<p>In most implementations, fulfilling this requirement is straightforward:</p>
<ul class="simple">
<li><p>The user <strong>notifies the library</strong> whenever a resource value changes
(e.g., on every update or at a high frequency).</p></li>
<li><p>The library then decides whether to <strong>send a notification</strong> to the server
based on the configured observation attributes.</p></li>
<li><p>The user does <strong>not</strong> need to explicitly handle observations or attributes
in their code.</p></li>
</ul>
</section>
<section id="observe-notify-for-lwm2m-gateway-eids">
<h3><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">7.3.1.2. </span>Observe/Notify for LwM2M Gateway EIDs</a><a class="headerlink" href="#observe-notify-for-lwm2m-gateway-eids" title="Link to this heading"></a></h3>
<p>The observation mechanism works the same way for <strong>LwM2M Gateway EIDs</strong> as it
does for regular LwM2M devices. However, three additional APIs are provided:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">anjay_lwm2m_gateway_notify_changed</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anjay_lwm2m_gateway_notify_instances_changed</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anjay_lwm2m_gateway_resource_observation_status</span></code></p></li>
</ul>
<p>These functions work similarly to their standard LwM2M client counterparts but
require an additional parameter: <strong>the EID</strong>. The EID is an integer ID assigned
when calling <code class="docutils literal notranslate"><span class="pre">anjay_lwm2m_gateway_register_device()</span></code>,
<a class="reference internal" href="LwM2MGatewayAPI.html#lwm2m-gateway-register-device"><span class="std std-ref">as shown here</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If an <strong>EID is deregistered</strong>, all active observations on its resources
are <strong>automatically canceled</strong>.
As per <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7641.html#section-4.2">RFC 7641 (CoAP Observe), section 4.2</a>, the client
will respond with <strong>4.04 Not Found</strong> for any observations on a removed EID.</p>
</div>
</section>
<section id="optimizing-notifications-for-eids">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">7.3.1.3. </span>Optimizing notifications for EIDs</a><a class="headerlink" href="#optimizing-notifications-for-eids" title="Link to this heading"></a></h3>
<p>Notifying the library for every resource change is impractical for EIDs.
Continuously sending updates would cause excessive communication overhead,
which is undesirable for low-power, battery-operated devices.</p>
<p>The following example outlines an optimized approach for handling observations,
specifically for <strong>temperature measurements</strong> using the <strong>Temperature Object</strong>.</p>
<p>The optimization includes:</p>
<ul class="simple">
<li><p><strong>A caching mechanism</strong> to store recently read resource values, reducing
unnecessary communication with EIDs.</p></li>
<li><p><strong>Intelligent update logic</strong> that:
- Limits communication when resources are not observed.
- Adjusts update frequency based on the <code class="docutils literal notranslate"><span class="pre">epmax</span></code> (Maximum Evaluation
Period) observation attribute.</p></li>
</ul>
<p>This approach ensures efficient resource monitoring while minimizing power
and communication costs.</p>
</section>
</section>
<section id="example">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">7.3.2. </span>Example</a><a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Complete code of this example can be found in
<code class="docutils literal notranslate"><span class="pre">examples/commercial-features/CF-LwM2M-Gateway</span></code> subdirectory of the
main Anjay project repository.</p>
</div>
<section id="cache-mechanism">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">7.3.2.1. </span>Cache mechanism</a><a class="headerlink" href="#cache-mechanism" title="Link to this heading"></a></h3>
<p>In Anjay, it is transparent to the user whether a resource read occurs due to:</p>
<ol class="arabic simple">
<li><p>A <strong>Read operation</strong> from the LwM2M Server.</p></li>
<li><p>A <strong>notification requirement</strong> triggered by the library.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">resource_read</span></code> callback must return a recent enough value to be useful.
A basic approach would be to immediately query the EID for the latest value,
but this can cause unnecessary communication overhead.</p>
<p>To prevent redundant reads, the gateway should periodically read resource values
and notify Anjay of changes using <code class="docutils literal notranslate"><span class="pre">anjay_lwm2m_gateway_notify_changed</span></code>.
However, calling this API causes the library to <strong>read the resource again</strong>,
potentially leading to <strong>duplicate queries</strong>.</p>
<p><strong>Optimizing with a cache</strong></p>
<p>A caching mechanism can be implemented to store recently read resource values,
reducing unnecessary queries to the EID:</p>
<ul class="simple">
<li><p>If a resource read is triggered <strong>twice in a short period</strong> (first to check
if the value has changed, then to fetch it), the cache prevents <strong>multiple
EID queries</strong>.</p></li>
<li><p>The cache stores each resource value along with a <strong>timestamp</strong> that
determines its validity.</p></li>
</ul>
<p>Cache data has the following structure:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">cached_value_struct</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="n">avs_time_monotonic_t</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span><span class="w"> </span><span class="n">cached_value_t</span><span class="p">;</span>
</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">temperature_instance_struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">anjay_iid_t</span><span class="w"> </span><span class="n">iid</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">application_type</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">application_type_backup</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

<span class="hll"><span class="w">    </span><span class="n">cached_value_t</span><span class="w"> </span><span class="n">max_meas_cached_value</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="n">cached_value_t</span><span class="w"> </span><span class="n">min_meas_cached_value</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="n">cached_value_t</span><span class="w"> </span><span class="n">sensor_meas_cached_value</span><span class="p">;</span>
</span><span class="p">}</span><span class="w"> </span><span class="n">temperature_instance_t</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Fetching cached values efficiently</strong></p>
<p>All resource accesses are handled through the cache, using the following
function:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">get_eid_resource_value</span><span class="p">(</span><span class="n">temperature_object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">anjay_rid_t</span><span class="w"> </span><span class="n">rid</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">cached_value_t</span><span class="w"> </span><span class="o">*</span><span class="n">cached_value</span><span class="p">,</span>
<span class="w">                                  </span><span class="kt">bool</span><span class="w"> </span><span class="n">force_update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">avs_time_monotonic_t</span><span class="w"> </span><span class="n">current_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avs_time_monotonic_now</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">force_update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">diff</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">avs_time_duration_to_scalar</span><span class="p">(</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="n">AVS_TIME_S</span><span class="p">,</span>
<span class="w">                    </span><span class="n">avs_time_monotonic_diff</span><span class="p">(</span><span class="n">current_time</span><span class="p">,</span>
<span class="w">                                            </span><span class="n">cached_value</span><span class="o">-&gt;</span><span class="n">timestamp</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ANJAY_ERR_INTERNAL</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">diff</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">CACHE_VALID_PERIOD_S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">VALUE_MESSAGE_MAX_LEN</span><span class="p">];</span>
<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gateway_request</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">gateway_srv</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">end_device_iid</span><span class="p">,</span>
</span><span class="hll"><span class="w">                               </span><span class="n">rid_to_request_type</span><span class="p">(</span><span class="n">rid</span><span class="p">),</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span>
</span><span class="hll"><span class="w">                               </span><span class="n">VALUE_MESSAGE_MAX_LEN</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span>
<span class="w">    </span><span class="n">cached_value</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">    </span><span class="n">cached_value</span><span class="o">-&gt;</span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_time</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This function first checks if the cached value is still valid. If so, it
returns the cached value. Otherwise, it queries the EID, updates the cache,
and returns the fresh value. The cache validity period is defined by the
<code class="docutils literal notranslate"><span class="pre">CACHE_VALID_PERIOD_S</span></code> constant.</p>
<p><strong>Using the cache in refresh mechanism</strong></p>
<p>This caching mechanism is used in both the <code class="docutils literal notranslate"><span class="pre">resource_read</span></code> callback and in
the function that periodically refreshes observed resource values:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">resource_read</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_dm_object_def_t</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">obj_ptr</span><span class="p">,</span>
<span class="w">                         </span><span class="n">anjay_iid_t</span><span class="w"> </span><span class="n">iid</span><span class="p">,</span>
<span class="w">                         </span><span class="n">anjay_rid_t</span><span class="w"> </span><span class="n">rid</span><span class="p">,</span>
<span class="w">                         </span><span class="n">anjay_riid_t</span><span class="w"> </span><span class="n">riid</span><span class="p">,</span>
<span class="w">                         </span><span class="n">anjay_output_ctx_t</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">anjay</span><span class="p">;</span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">riid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ANJAY_ID_INVALID</span><span class="p">);</span>

<span class="w">    </span><span class="n">temperature_object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_obj</span><span class="p">(</span><span class="n">obj_ptr</span><span class="p">);</span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">iid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">AVS_ARRAY_SIZE</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">));</span>
<span class="w">    </span><span class="n">temperature_instance_t</span><span class="w"> </span><span class="o">*</span><span class="n">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">rid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">RID_MIN_MEASURED_VALUE</span><span class="p">:</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">RID_MAX_MEASURED_VALUE</span><span class="p">:</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">RID_SENSOR_VALUE</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cached_value_t</span><span class="w"> </span><span class="o">*</span><span class="n">cached_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rid_to_cached_value</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">);</span>
<span class="hll"><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_eid_resource_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">,</span><span class="w"> </span><span class="n">cached_value</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ANJAY_ERR_INTERNAL</span>
<span class="w">                   </span><span class="o">:</span><span class="w"> </span><span class="n">anjay_ret_double</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">cached_value</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">RID_APPLICATION_TYPE</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">anjay_ret_string</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">inst</span><span class="o">-&gt;</span><span class="n">application_type</span><span class="p">);</span>

<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ANJAY_ERR_METHOD_NOT_ALLOWED</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="resource-refresh-mechanism">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">7.3.2.2. </span>Resource refresh mechanism</a><a class="headerlink" href="#resource-refresh-mechanism" title="Link to this heading"></a></h3>
<p>The function that refreshes resource values and calls
<code class="docutils literal notranslate"><span class="pre">anjay_lwm2m_gateway_notify_changed</span></code> follows a structure similar to the
approach described in the <a class="reference internal" href="../BasicClient/BC-Notifications.html"><span class="doc">Notifications support</span></a> tutorial:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">notify_job</span><span class="p">(</span><span class="n">avs_sched_t</span><span class="w"> </span><span class="o">*</span><span class="n">sched</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">args_ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">job_args_t</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">job_args_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">args_ptr</span><span class="p">;</span>

<span class="w">    </span><span class="n">temperature_object_update_value</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">temperature_object</span><span class="p">);</span>

<span class="w">    </span><span class="n">AVS_SCHED_DELAYED</span><span class="p">(</span><span class="n">sched</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">notify_job_handle</span><span class="p">,</span>
<span class="w">                      </span><span class="n">avs_time_duration_from_scalar</span><span class="p">(</span>
<span class="w">                              </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">evaluation_period</span><span class="p">,</span><span class="w"> </span><span class="n">AVS_TIME_S</span><span class="p">),</span>
<span class="w">                      </span><span class="n">notify_job</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Updating observed resource values</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">temperature_object_update_value</span></code> function is responsible for updating the
resource values and notifying the library about the changes. Notice that this
function doesn’t refresh values of resources that are not observed:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update_resource</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">                            </span><span class="n">temperature_object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="p">,</span>
<span class="w">                            </span><span class="n">temperature_instance_t</span><span class="w"> </span><span class="o">*</span><span class="n">inst</span><span class="p">,</span>
<span class="w">                            </span><span class="n">anjay_rid_t</span><span class="w"> </span><span class="n">rid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="n">anjay_resource_observation_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span>
</span><span class="hll"><span class="w">            </span><span class="n">anjay_lwm2m_gateway_resource_observation_status</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span>
</span><span class="hll"><span class="w">                                                            </span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">end_device_iid</span><span class="p">,</span>
</span><span class="hll"><span class="w">                                                            </span><span class="n">OID_TEMPERATURE</span><span class="p">,</span>
</span><span class="hll"><span class="w">                                                            </span><span class="n">inst</span><span class="o">-&gt;</span><span class="n">iid</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">);</span>
</span><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">is_observed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">        </span><span class="n">cached_value_t</span><span class="w"> </span><span class="o">*</span><span class="n">cached_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rid_to_cached_value</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">);</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">prev_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cached_value</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="w">        </span><span class="n">get_eid_resource_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">,</span><span class="w"> </span><span class="n">cached_value</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prev_value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cached_value</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">anjay_lwm2m_gateway_notify_changed</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">end_device_iid</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">OID_TEMPERATURE</span><span class="p">,</span><span class="w"> </span><span class="n">inst</span><span class="o">-&gt;</span><span class="n">iid</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">temperature_object_update_value</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_dm_object_def_t</span><span class="w"> </span><span class="o">**</span><span class="n">def</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">anjay</span><span class="p">);</span>
<span class="w">    </span><span class="n">temperature_object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_obj</span><span class="p">(</span><span class="n">def</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">iid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">AVS_ARRAY_SIZE</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">);</span><span class="w"> </span><span class="n">iid</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">update_resource</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">],</span>
<span class="w">                        </span><span class="n">RID_MIN_MEASURED_VALUE</span><span class="p">);</span>
<span class="w">        </span><span class="n">update_resource</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">],</span>
<span class="w">                        </span><span class="n">RID_MAX_MEASURED_VALUE</span><span class="p">);</span>
<span class="w">        </span><span class="n">update_resource</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">],</span><span class="w"> </span><span class="n">RID_SENSOR_VALUE</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Dynamic adjustment based on epmax</strong></p>
<p>The periodic refresh of resource values for observed resources is dynamically
adjusted based on the <code class="docutils literal notranslate"><span class="pre">epmax</span></code> observation attribute. This attribute defines
the maximum interval between evaluations that determine whether a notification
should be sent.</p>
<p>The mechanism is implemented through a scheduled job that regularly queries
Anjay for a list of currently observed resources. If any of the resources in
this object is observed, the job responsible for refreshing resource values is
rescheduled to run at a higher frequency. Specifically, the interval is set to
the lowest <code class="docutils literal notranslate"><span class="pre">epmax</span></code> value among all observed resources.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculate_evaluation_period_job</span><span class="p">(</span><span class="n">avs_sched_t</span><span class="w"> </span><span class="o">*</span><span class="n">sched</span><span class="p">,</span>
<span class="w">                                            </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">args_ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">job_args_t</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">job_args_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">args_ptr</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Schedule run of the same function to track the evaluation period</span>
<span class="w">    </span><span class="c1">// continuously</span>
<span class="w">    </span><span class="n">AVS_SCHED_DELAYED</span><span class="p">(</span><span class="n">sched</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">evaluation_period_job_handle</span><span class="p">,</span>
<span class="w">                      </span><span class="n">avs_time_duration_from_scalar</span><span class="p">(</span><span class="n">EVALUATION_CALC_JOB_PERIOD</span><span class="p">,</span>
<span class="w">                                                    </span><span class="n">AVS_TIME_S</span><span class="p">),</span>
<span class="w">                      </span><span class="n">calculate_evaluation_period_job</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">));</span>

<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">prev_evaluation_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">evaluation_period</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">new_evaluation_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_MAXIMAL_EVALUATION_PERIOD</span><span class="p">;</span>

<span class="hll"><span class="w">    </span><span class="n">temperature_object_evaluation_period_update_value</span><span class="p">(</span>
</span><span class="hll"><span class="w">            </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">anjay</span><span class="p">,</span>
</span><span class="hll"><span class="w">            </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">temperature_object</span><span class="p">,</span>
</span><span class="hll"><span class="w">            </span><span class="o">&amp;</span><span class="n">new_evaluation_period</span><span class="p">);</span>
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_evaluation_period</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">prev_evaluation_period</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">evaluation_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_evaluation_period</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// if evaluation period has changed, notify job should be rescheduled</span>
<span class="w">    </span><span class="c1">// accordingly to new period</span>
<span class="w">    </span><span class="n">avs_time_monotonic_t</span><span class="w"> </span><span class="n">new_notify_instant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avs_time_monotonic_add</span><span class="p">(</span>
<span class="w">            </span><span class="n">avs_time_monotonic_add</span><span class="p">(</span>
<span class="w">                    </span><span class="n">avs_sched_time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">notify_job_handle</span><span class="p">),</span>
<span class="w">                    </span><span class="n">avs_time_duration_from_scalar</span><span class="p">(</span><span class="o">-</span><span class="n">prev_evaluation_period</span><span class="p">,</span>
<span class="w">                                                  </span><span class="n">AVS_TIME_S</span><span class="p">)),</span>
<span class="w">            </span><span class="n">avs_time_duration_from_scalar</span><span class="p">(</span><span class="n">new_evaluation_period</span><span class="p">,</span><span class="w"> </span><span class="n">AVS_TIME_S</span><span class="p">));</span>
<span class="w">    </span><span class="n">AVS_RESCHED_AT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">end_device</span><span class="o">-&gt;</span><span class="n">notify_job_handle</span><span class="p">,</span><span class="w"> </span><span class="n">new_notify_instant</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">temperature_object_evaluation_period_update_value</span></code> function is
responsible for finding the lowest <code class="docutils literal notranslate"><span class="pre">epmax</span></code> value for all observed resources
that depend on the temperature measured by an EID:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">evaluation_period_update_value</span><span class="p">(</span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">                                           </span><span class="n">temperature_object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="p">,</span>
<span class="w">                                           </span><span class="n">temperature_instance_t</span><span class="w"> </span><span class="o">*</span><span class="n">inst</span><span class="p">,</span>
<span class="w">                                           </span><span class="n">anjay_rid_t</span><span class="w"> </span><span class="n">rid</span><span class="p">,</span>
<span class="w">                                           </span><span class="kt">int32_t</span><span class="w"> </span><span class="o">*</span><span class="n">max_evaluation_period</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">anjay_resource_observation_status_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">anjay_lwm2m_gateway_resource_observation_status</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">                                                            </span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">end_device_iid</span><span class="p">,</span>
<span class="w">                                                            </span><span class="n">OID_TEMPERATURE</span><span class="p">,</span>
<span class="w">                                                            </span><span class="n">inst</span><span class="o">-&gt;</span><span class="n">iid</span><span class="p">,</span><span class="w"> </span><span class="n">rid</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">is_observed</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">max_eval_period</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ANJAY_ATTRIB_PERIOD_NONE</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">max_evaluation_period</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">max_eval_period</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">max_evaluation_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">max_eval_period</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">temperature_object_evaluation_period_update_value</span><span class="p">(</span>
<span class="w">        </span><span class="n">anjay_t</span><span class="w"> </span><span class="o">*</span><span class="n">anjay</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">anjay_dm_object_def_t</span><span class="w"> </span><span class="o">**</span><span class="n">def</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int32_t</span><span class="w"> </span><span class="o">*</span><span class="n">evaluation_period</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">anjay</span><span class="p">);</span>
<span class="w">    </span><span class="n">temperature_object_t</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_obj</span><span class="p">(</span><span class="n">def</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">iid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">AVS_ARRAY_SIZE</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">);</span><span class="w"> </span><span class="n">iid</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">evaluation_period_update_value</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">],</span>
<span class="w">                                       </span><span class="n">RID_MIN_MEASURED_VALUE</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">evaluation_period</span><span class="p">);</span>
<span class="w">        </span><span class="n">evaluation_period_update_value</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">],</span>
<span class="w">                                       </span><span class="n">RID_MAX_MEASURED_VALUE</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">evaluation_period</span><span class="p">);</span>
<span class="w">        </span><span class="n">evaluation_period_update_value</span><span class="p">(</span><span class="n">anjay</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">instances</span><span class="p">[</span><span class="n">iid</span><span class="p">],</span>
<span class="w">                                       </span><span class="n">RID_SENSOR_VALUE</span><span class="p">,</span><span class="w"> </span><span class="n">evaluation_period</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="conclusion">
<h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">7.3.3. </span>Conclusion</a><a class="headerlink" href="#conclusion" title="Link to this heading"></a></h2>
<p>This approach shows how the LwM2M Gateway can efficiently manage
<strong>Observe/Notify</strong> operations for EIDs while keeping communication to a minimum.
By optimizing when and how updates are sent, devices can stay responsive
without unnecessary data transfers.</p>
<p>However, the best implementation depends on your specific <strong>use case</strong>.
Several factors should guide your design:</p>
<ul class="simple">
<li><p><strong>Update Frequency</strong> – How often should resource values be refreshed?</p></li>
<li><p><strong>Real-Time Accuracy</strong> – How critical is immediate data reporting?</p></li>
<li><p><strong>Power Constraints</strong> – Can the End Device handle frequent updates,
or does it need to conserve energy?</p></li>
</ul>
<p>Developers should <strong>fine-tune</strong> their LwM2M Gateway implementation based on
these factors. The goal is to strike the right balance between <strong>data freshness,
power efficiency, and network optimization</strong>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LwM2MGatewayAPI.html" class="btn btn-neutral float-left" title="7.2. LwM2M Gateway API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="LwM2MGatewaySend.html" class="btn btn-neutral float-right" title="7.4. Send method for LwM2M Gateway EIDs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2025, AVSystem.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>