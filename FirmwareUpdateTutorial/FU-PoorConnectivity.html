<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6.5. Poor network connectivity &mdash; Anjay 3.10.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=86f27845" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=2238f999" />

  
  
        <script src="../_static/jquery.js?v=8dae8fb0"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=f8d09eac"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.6. Download resumption" href="FU-DownloadResumption.html" />
    <link rel="prev" title="6.4. Secure downloads" href="FU-SecureDownloads.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffd500" >

          
          
          <a href="../index.html">
            
              <img src="../_static/avsystem_header.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.10.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BasicClient.html">4. Basic client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdvancedTopics.html">5. Advanced topics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../FirmwareUpdateTutorial.html">6. Firmware Update Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="FU-Introduction.html">6.1. Firmware Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="FU-BasicImplementation.html">6.2. Basic implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FU-ModesAndProtocols.html">6.3. Download modes and protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="FU-SecureDownloads.html">6.4. Secure downloads</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.5. Poor network connectivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="FU-DownloadResumption.html">6.6. Download resumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="FU-AdvancedFirmwareUpdate.html">6.7. Advanced Firmware Update</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2MGateway.html">7. LwM2M Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">8. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_description.html">9. API description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PortingGuideForNonPOSIXPlatforms.html">10. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Migrating.html">11. Migrating from older versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CommercialFeatures.html">12. Commercial features</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ffd500" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anjay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../FirmwareUpdateTutorial.html"><span class="section-number">6. </span>Firmware Update Tutorial</a></li>
      <li class="breadcrumb-item active"><span class="section-number">6.5. </span>Poor network connectivity</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="poor-network-connectivity">
<h1><span class="section-number">6.5. </span>Poor network connectivity<a class="headerlink" href="#poor-network-connectivity" title="Link to this heading"></a></h1>
<section id="introduction">
<h2><span class="section-number">6.5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>It is sometimes the case that the network connectivity is unstable,
and during the download some packets get lost. Depending on the underlying
download protocol different failures are handled differently.</p>
</section>
<section id="the-definition-of-download-failure">
<h2><span class="section-number">6.5.2. </span>The definition of “download failure”<a class="headerlink" href="#the-definition-of-download-failure" title="Link to this heading"></a></h2>
<p>Since the variety of protocols may be used to perform the transfer, we
need to understand better what conditions cause the download to fail. Let’s
consider this case by case:</p>
<section id="coap-s-udp">
<h3><span class="section-number">6.5.2.1. </span>CoAP(s)/UDP<a class="headerlink" href="#coap-s-udp" title="Link to this heading"></a></h3>
<p>The download fails if either the connection could not be established (e.g.
DTLS handshake failure) or when all request retransmissions were performed
and no response have been received.</p>
</section>
<section id="coap-s-tcp">
<h3><span class="section-number">6.5.2.2. </span>CoAP(s)/TCP<a class="headerlink" href="#coap-s-tcp" title="Link to this heading"></a></h3>
<p>The download fails if either the connection could not be established (e.g.
TLS handshake failure, remote host is down) or the TCP stack declares
the connection as broken, or when there is no response to the request for
the configured time; by default that time is 30 seconds.</p>
</section>
<section id="http-s">
<h3><span class="section-number">6.5.2.3. </span>HTTP(s)<a class="headerlink" href="#http-s" title="Link to this heading"></a></h3>
<p>The download fails due to similar reasons as above. Since HTTP(s) operates
over TCP and the TCP stack maintains retransmissions and other things in a
way outside of our control. The reponse timeout is configured the same way as
for CoAP(s)/TCP, and the default timeout is also 30 seconds.</p>
</section>
</section>
<section id="so-what-happens-when-the-download-fails">
<h2><span class="section-number">6.5.3. </span>So what happens when the download fails?<a class="headerlink" href="#so-what-happens-when-the-download-fails" title="Link to this heading"></a></h2>
<p>When the download fails, the firmware update module calls <code class="docutils literal notranslate"><span class="pre">reset</span></code>
handler. Its implementation is required to cleanup any outstanding resources,
and prepare the Client for a potential new download request.</p>
</section>
<section id="how-can-we-ensure-higher-success-rate">
<span id="id1"></span><h2><span class="section-number">6.5.4. </span>How can we ensure higher success rate?<a class="headerlink" href="#how-can-we-ensure-higher-success-rate" title="Link to this heading"></a></h2>
<p>For CoAP/UDP, you can provide the <a class="reference internal" href="../AdvancedTopics/AT-RetransmissionsTimeoutsCaching.html#coap-retransmission-parameters"><span class="std std-ref">CoAP transmission parameters</span></a> by implementing the <code class="docutils literal notranslate"><span class="pre">get_coap_tx_params</span></code>
handler, which is a part of <code class="docutils literal notranslate"><span class="pre">anjay_fw_update_handlers_t</span></code>. If not provided,
default CoAP transmission parameters (or passed as part of
<code class="docutils literal notranslate"><span class="pre">anjay_configuration_t</span></code>) will be used.</p>
<p>In a similar manner, for TCP-based transports (i.e., CoAP(s)/TCP and HTTP(s))
you can implement the <code class="docutils literal notranslate"><span class="pre">get_tcp_request_timeout</span></code> to set a custom request
timeout. This is the time of stream inactivity that will be treated as an error.</p>
<p>For CoAP(s)/UDP and CoAP(s)/TCP, you can also use configuration parameters:
<code class="docutils literal notranslate"><span class="pre">coap_downloader_retry_count</span></code> and <code class="docutils literal notranslate"><span class="pre">coap_downloader_retry_delay</span></code> in
<code class="docutils literal notranslate"><span class="pre">anjay_configuration_t</span></code>. The first one specifies the number of attempts
to resume downloads, and the second specifies the delay between retries.
This is not a mechanism of the CoAP protocol, but an additional layer of
abstraction that allows resumption of downloads in case of network errors.
The download will start from the point where it was interrupted. Using the
DTLS Connection ID extension makes it possible to resume the connection without
performing a handshake. In case of a poor connectivity, a combination of
Connection ID and ETag provides the optimal solution. The ETag parameter is not
mandatory, but if it is passed by the server then its value is checked when the
download is resumed. The download is considered unsuccessful and the <code class="docutils literal notranslate"><span class="pre">reset</span></code>
handler is called after the last failed attempt. If <code class="docutils literal notranslate"><span class="pre">coap_downloader_retry_count</span></code>
is not set, functionality is disabled.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="FU-SecureDownloads.html" class="btn btn-neutral float-left" title="6.4. Secure downloads" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FU-DownloadResumption.html" class="btn btn-neutral float-right" title="6.6. Download resumption" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2025, AVSystem.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>