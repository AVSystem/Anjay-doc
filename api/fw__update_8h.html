<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>anjay: modules/fw_update/include_public/anjay/fw_update.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">anjay
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fw__update_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">fw_update.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="dm_8h_source.html">anjay/dm.h</a>&gt;</code><br />
</div>
<p><a href="fw__update_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structanjay__fw__update__initial__state__t.html">anjay_fw_update_initial_state_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structanjay__fw__update__handlers__t.html">anjay_fw_update_handlers_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:aefc50329eabcf89ae42815834c2f7e03"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#aefc50329eabcf89ae42815834c2f7e03">ANJAY_FW_UPDATE_ERR_NOT_ENOUGH_SPACE</a>&#160;&#160;&#160;(-2)</td></tr>
<tr class="separator:aefc50329eabcf89ae42815834c2f7e03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a740d43f61c0ba1dfa5b559d88835c32d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a740d43f61c0ba1dfa5b559d88835c32d">ANJAY_FW_UPDATE_ERR_OUT_OF_MEMORY</a>&#160;&#160;&#160;(-3)</td></tr>
<tr class="separator:a740d43f61c0ba1dfa5b559d88835c32d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fdc049704f72819d0a6b1de7df739fb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a2fdc049704f72819d0a6b1de7df739fb">ANJAY_FW_UPDATE_ERR_INTEGRITY_FAILURE</a>&#160;&#160;&#160;(-5)</td></tr>
<tr class="separator:a2fdc049704f72819d0a6b1de7df739fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a577fdccd2bede0ee6e284ef55b24621b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a577fdccd2bede0ee6e284ef55b24621b">ANJAY_FW_UPDATE_ERR_UNSUPPORTED_PACKAGE_TYPE</a>&#160;&#160;&#160;(-6)</td></tr>
<tr class="separator:a577fdccd2bede0ee6e284ef55b24621b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a024b15279a6415219f67ba9e2dadaa61"><td class="memItemLeft" align="right" valign="top">typedef int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a024b15279a6415219f67ba9e2dadaa61">anjay_fw_update_stream_open_t</a>(void *user_ptr, const char *package_uri, const struct <a class="el" href="structanjay__etag.html">anjay_etag</a> *package_etag)</td></tr>
<tr class="separator:a024b15279a6415219f67ba9e2dadaa61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae148a3839561015f353ef47c330e9182"><td class="memItemLeft" align="right" valign="top">typedef int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#ae148a3839561015f353ef47c330e9182">anjay_fw_update_stream_write_t</a>(void *user_ptr, const void *data, size_t length)</td></tr>
<tr class="separator:ae148a3839561015f353ef47c330e9182"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12fbe115b343ae099274cd73698ae660"><td class="memItemLeft" align="right" valign="top">typedef int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a12fbe115b343ae099274cd73698ae660">anjay_fw_update_stream_finish_t</a>(void *user_ptr)</td></tr>
<tr class="separator:a12fbe115b343ae099274cd73698ae660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13a472bcf015f0d4f8b69b240d68d10a"><td class="memItemLeft" align="right" valign="top">typedef void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a13a472bcf015f0d4f8b69b240d68d10a">anjay_fw_update_reset_t</a>(void *user_ptr)</td></tr>
<tr class="separator:a13a472bcf015f0d4f8b69b240d68d10a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a270e3076262423d8ef7f99333249b9ac"><td class="memItemLeft" align="right" valign="top">typedef const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a270e3076262423d8ef7f99333249b9ac">anjay_fw_update_get_name_t</a>(void *user_ptr)</td></tr>
<tr class="separator:a270e3076262423d8ef7f99333249b9ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a2a8ad514cff78979eb806dba248713"><td class="memItemLeft" align="right" valign="top">typedef const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a3a2a8ad514cff78979eb806dba248713">anjay_fw_update_get_version_t</a>(void *user_ptr)</td></tr>
<tr class="separator:a3a2a8ad514cff78979eb806dba248713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81c7c16c083eb93677d8a9d6df78a13c"><td class="memItemLeft" align="right" valign="top">typedef int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a81c7c16c083eb93677d8a9d6df78a13c">anjay_fw_update_perform_upgrade_t</a>(void *user_ptr)</td></tr>
<tr class="separator:a81c7c16c083eb93677d8a9d6df78a13c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a528128908ddd63124b2722950f8f4791"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791">anjay_fw_update_initial_result_t</a> { <br />
&#160;&#160;<a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791a225f14e4b831e3e5b83e0eb59ae406df">ANJAY_FW_UPDATE_INITIAL_DOWNLOADED</a> = -2, 
<a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791ad46861328088bf6db54fced8723302ac">ANJAY_FW_UPDATE_INITIAL_DOWNLOADING</a> = -1, 
<a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791a33125a5a19f3ecdc68d7f46888b3337e">ANJAY_FW_UPDATE_INITIAL_NEUTRAL</a> = 0, 
<a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791a18caf6ef11603ba8d6758b20e1862352">ANJAY_FW_UPDATE_INITIAL_SUCCESS</a> = 1, 
<br />
&#160;&#160;<a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791ab6f5d45cff4db30449341dd0fbda9373">ANJAY_FW_UPDATE_INITIAL_INTEGRITY_FAILURE</a> = 5, 
<a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791a64cdc79696290cc3695fbd34e15d8276">ANJAY_FW_UPDATE_INITIAL_FAILED</a> = 8
<br />
 }</td></tr>
<tr class="separator:a528128908ddd63124b2722950f8f4791"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a058f05510e5b22fbdf53466a03cc6d38"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a> (<a class="el" href="core_8h.html#a6c9664a3b0c2d5629c9639dce7b1dbfb">anjay_t</a> *anjay, const <a class="el" href="structanjay__fw__update__handlers__t.html">anjay_fw_update_handlers_t</a> *handlers, void *user_arg, const <a class="el" href="structanjay__fw__update__initial__state__t.html">anjay_fw_update_initial_state_t</a> *initial_state)</td></tr>
<tr class="separator:a058f05510e5b22fbdf53466a03cc6d38"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a2fdc049704f72819d0a6b1de7df739fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fdc049704f72819d0a6b1de7df739fb">&#9670;&nbsp;</a></span>ANJAY_FW_UPDATE_ERR_INTEGRITY_FAILURE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ANJAY_FW_UPDATE_ERR_INTEGRITY_FAILURE&#160;&#160;&#160;(-5)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aefc50329eabcf89ae42815834c2f7e03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefc50329eabcf89ae42815834c2f7e03">&#9670;&nbsp;</a></span>ANJAY_FW_UPDATE_ERR_NOT_ENOUGH_SPACE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ANJAY_FW_UPDATE_ERR_NOT_ENOUGH_SPACE&#160;&#160;&#160;(-2)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The following result codes may be returned from <a class="el" href="fw__update_8h.html#ae148a3839561015f353ef47c330e9182">anjay_fw_update_stream_write_t</a>, <a class="el" href="fw__update_8h.html#a12fbe115b343ae099274cd73698ae660">anjay_fw_update_stream_finish_t</a> or <a class="el" href="fw__update_8h.html#a81c7c16c083eb93677d8a9d6df78a13c">anjay_fw_update_perform_upgrade_t</a> to control the value of the Update Result Resource after the failure.</p>
<p>Their values correspond to negated numeric values of that resource. However, attempting to use other negated value will be checked and cause a fall-back to a value default for a given handler. </p>

</div>
</div>
<a id="a740d43f61c0ba1dfa5b559d88835c32d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a740d43f61c0ba1dfa5b559d88835c32d">&#9670;&nbsp;</a></span>ANJAY_FW_UPDATE_ERR_OUT_OF_MEMORY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ANJAY_FW_UPDATE_ERR_OUT_OF_MEMORY&#160;&#160;&#160;(-3)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a577fdccd2bede0ee6e284ef55b24621b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a577fdccd2bede0ee6e284ef55b24621b">&#9670;&nbsp;</a></span>ANJAY_FW_UPDATE_ERR_UNSUPPORTED_PACKAGE_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ANJAY_FW_UPDATE_ERR_UNSUPPORTED_PACKAGE_TYPE&#160;&#160;&#160;(-6)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a270e3076262423d8ef7f99333249b9ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a270e3076262423d8ef7f99333249b9ac">&#9670;&nbsp;</a></span>anjay_fw_update_get_name_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef const char* anjay_fw_update_get_name_t(void *user_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the name of downloaded firmware package.</p>
<p>The name will be exposed in the data model as the PkgName Resource. If this callback returns <code>NULL</code> or is not implemented at all (with the corresponding field set to <code>NULL</code>), that Resource will not be present in the data model.</p>
<p>It only makes sense for this handler to return non-<code>NULL</code> values if there is a valid package already downloaded. The library will not call this handler in any state other than <em>Downloaded</em>.</p>
<p>The library will not attempt to deallocate the returned pointer. User code must assure that the pointer will remain valid at least until return from <a class="el" href="core_8h.html#a45308768471c1cdce837abeef1d8567e">anjay_serve</a> or <a class="el" href="core_8h.html#a70470009dd11bd05aa6e8526bcc23de4">anjay_sched_run</a> .</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The callback shall return a pointer to a null-terminated string containing tha package name, or <code>NULL</code> if it is not currently available. </dd></dl>

</div>
</div>
<a id="a3a2a8ad514cff78979eb806dba248713"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a2a8ad514cff78979eb806dba248713">&#9670;&nbsp;</a></span>anjay_fw_update_get_version_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef const char* anjay_fw_update_get_version_t(void *user_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the version of downloaded firmware package.</p>
<p>The version will be exposed in the data model as the PkgVersion Resource. If this callback returns <code>NULL</code> or is not implemented at all (with the corresponding field set to <code>NULL</code>), that Resource will not be present in the data model.</p>
<p>It only makes sense for this handler to return non-<code>NULL</code> values if there is a valid package already downloaded. The library will not call this handler in any state other than <em>Downloaded</em>.</p>
<p>The library will not attempt to deallocate the returned pointer. User code must assure that the pointer will remain valid at least until return from <a class="el" href="core_8h.html#a45308768471c1cdce837abeef1d8567e">anjay_serve</a> or <a class="el" href="core_8h.html#a70470009dd11bd05aa6e8526bcc23de4">anjay_sched_run</a> .</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The callback shall return a pointer to a null-terminated string containing tha package version, or <code>NULL</code> if it is not currently available. </dd></dl>

</div>
</div>
<a id="a81c7c16c083eb93677d8a9d6df78a13c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81c7c16c083eb93677d8a9d6df78a13c">&#9670;&nbsp;</a></span>anjay_fw_update_perform_upgrade_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int anjay_fw_update_perform_upgrade_t(void *user_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Performs the actual upgrade with previously downloaded package.</p>
<p>Will be called at request of the server, after a package has been downloaded. It is expected that this callback will do either one of the following:</p>
<ul>
<li>return, causing the outermost event loop to terminate, shutdown the library and then perform the firmware upgrade and then the device to reboot</li>
<li>perform the firmware upgrade internally and never return, causing a reboot in the process</li>
</ul>
<p>In any case, it is expected that the device will then reboot. After rebooting, the result of the upgrade process may be passed to the library during initialization via the <code>initial_result</code> argument to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a> .</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The callback shall return a negative if it can be determined without a reboot that the firmware upgrade cannot be successfully performed. If one of the <code>ANJAY_FW_UPDATE_ERR_*</code> value is returned, an equivalent value will be set in the Update Result Resource. If an update is to be attempted, it shall either return 0 or perform a reboot internally without returning. In either case, a reboot or at least a reinitialization of the library is then required to pass the update result. </dd></dl>

</div>
</div>
<a id="a13a472bcf015f0d4f8b69b240d68d10a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13a472bcf015f0d4f8b69b240d68d10a">&#9670;&nbsp;</a></span>anjay_fw_update_reset_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void anjay_fw_update_reset_t(void *user_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Resets the firmware update state and performs any applicable cleanup of temporary storage if necessary.</p>
<p>Will be called at request of the server, or after a failed download. Note that it may be called without previously calling <a class="el" href="fw__update_8h.html#a12fbe115b343ae099274cd73698ae660">anjay_fw_update_stream_finish_t</a>, so it shall also close the currently open download stream, if any.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a12fbe115b343ae099274cd73698ae660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12fbe115b343ae099274cd73698ae660">&#9670;&nbsp;</a></span>anjay_fw_update_stream_finish_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int anjay_fw_update_stream_finish_t(void *user_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Closes the download stream and prepares the firmware package to be flashed.</p>
<p>Will be called after a series of <a class="el" href="fw__update_8h.html#ae148a3839561015f353ef47c330e9182">anjay_fw_update_stream_write_t</a> calls after the whole package is downloaded.</p>
<p>The intended way of implementing this handler is to e.g. call <code>fclose()</code> and perform integrity check on the downloaded file. It might also be uncompressed or decrypted as necessary, so that it is ready to be flashed. The exact split of responsibility between <a class="el" href="fw__update_8h.html#a12fbe115b343ae099274cd73698ae660">anjay_fw_update_stream_finish_t</a> and <a class="el" href="fw__update_8h.html#a81c7c16c083eb93677d8a9d6df78a13c">anjay_fw_update_perform_upgrade_t</a> is not clearly defined and up to the implementor.</p>
<p>Note that regardless of the return value, the stream is considered to be closed. That is, upon successful return, the Firmware Update object is considered to be in the <em>Downloaded</em> state, and upon returning an error - in the <em>Idle</em> state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The callback shall return 0 if successful or a negative value in case of error. If one of the <code>ANJAY_FW_UPDATE_ERR_*</code> value is returned, an equivalent value will be set in the Update Result Resource. </dd></dl>

</div>
</div>
<a id="a024b15279a6415219f67ba9e2dadaa61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a024b15279a6415219f67ba9e2dadaa61">&#9670;&nbsp;</a></span>anjay_fw_update_stream_open_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int anjay_fw_update_stream_open_t(void *user_ptr, const char *package_uri, const struct <a class="el" href="structanjay__etag.html">anjay_etag</a> *package_etag)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Opens the stream that will be used to write the firmware package to.</p>
<p>The intended way of implementing this handler is to open a temporary file using <code>fopen()</code> or allocate some memory buffer that may then be used to store the downloaded data in. The library will not attempt to call <a class="el" href="fw__update_8h.html#ae148a3839561015f353ef47c330e9182">anjay_fw_update_stream_write_t</a> without having previously called <a class="el" href="fw__update_8h.html#a024b15279a6415219f67ba9e2dadaa61">anjay_fw_update_stream_open_t</a> . Please see <a class="el" href="structanjay__fw__update__handlers__t.html">anjay_fw_update_handlers_t</a> for more information about state transitions.</p>
<p>Note that this handler will NOT be called after initializing the object with the <code>ANJAY_FW_UPDATE_INITIAL_DOWNLOADING</code> option, so any necessary resources shall be already open before calling <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a> .</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a></td></tr>
    <tr><td class="paramname">package_uri</td><td>URI of the package from which a Pull-mode download is performed, or <code>NULL</code> if it is a Push-mode download. This argument may either be ignored, or persisted in non-volatile storage if the client supports download resumption after an unexpected reboot (see <a class="el" href="structanjay__fw__update__initial__state__t.html">anjay_fw_update_initial_state_t</a> and its fields).</td></tr>
    <tr><td class="paramname">package_etag</td><td>ETag of the data being downloaded in Pull mode, or <code>NULL</code> if it is a Push-mode download or ETags are not supported by the remote server. This argument may either be ignored, or persisted in non-volatile storage if the client supports download resumption after an unexpected reboot (see <a class="el" href="structanjay__fw__update__initial__state__t.html">anjay_fw_update_initial_state_t</a> and its fields).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The callback shall return 0 if successful or a negative value in case of error. Error codes are <b>NOT</b> handled here, so attempting to return <code>ANJAY_FW_UPDATE_ERR_*</code> values will <b>NOT</b> cause any effect different than any other negative value. </dd></dl>

</div>
</div>
<a id="ae148a3839561015f353ef47c330e9182"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae148a3839561015f353ef47c330e9182">&#9670;&nbsp;</a></span>anjay_fw_update_stream_write_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int anjay_fw_update_stream_write_t(void *user_ptr, const void *data, size_t length)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes data to the download stream.</p>
<p>May be called multipled times after <a class="el" href="fw__update_8h.html#a024b15279a6415219f67ba9e2dadaa61">anjay_fw_update_stream_open_t</a>, once for each consecutive chunk of downloaded data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user_ptr</td><td>Opaque pointer to user data, as passed to <a class="el" href="fw__update_8h.html#a058f05510e5b22fbdf53466a03cc6d38">anjay_fw_update_install</a></td></tr>
    <tr><td class="paramname">data</td><td>Pointer to a chunk of the firmware package being downloaded. Guaranteed to be non-<code>NULL</code>.</td></tr>
    <tr><td class="paramname">length</td><td>Number of bytes in the chunk pointed to by <code>data</code>. Guaranteed to be greater than zero.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The callback shall return 0 if successful or a negative value in case of error. If one of the <code>ANJAY_FW_UPDATE_ERR_*</code> value is returned, an equivalent value will be set in the Update Result Resource. </dd></dl>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a528128908ddd63124b2722950f8f4791"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a528128908ddd63124b2722950f8f4791">&#9670;&nbsp;</a></span>anjay_fw_update_initial_result_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="fw__update_8h.html#a528128908ddd63124b2722950f8f4791">anjay_fw_update_initial_result_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Possible values that control the State and Update Result resources at the time of initialization of the Firmware Update object. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a528128908ddd63124b2722950f8f4791a225f14e4b831e3e5b83e0eb59ae406df"></a>ANJAY_FW_UPDATE_INITIAL_DOWNLOADED&#160;</td><td class="fielddoc"><p>Corresponds to the "Downloaded" State and "Initial" Result. Shall be used when the device unexpectedly rebooted when the firmware image has already been downloaded into some non-volatile memory. </p>
</td></tr>
<tr><td class="fieldname"><a id="a528128908ddd63124b2722950f8f4791ad46861328088bf6db54fced8723302ac"></a>ANJAY_FW_UPDATE_INITIAL_DOWNLOADING&#160;</td><td class="fielddoc"><p>Corresponds to the "Downloading" State and "Initial" Result. Shall be used when the device can determine that it unexpectedly rebooted during the download of the firmware image, and it has all the information necessary to resume the download. Such information shall then be passed via other fields in the <a class="el" href="structanjay__fw__update__initial__state__t.html">anjay_fw_update_initial_state_t</a> structure. </p>
</td></tr>
<tr><td class="fieldname"><a id="a528128908ddd63124b2722950f8f4791a33125a5a19f3ecdc68d7f46888b3337e"></a>ANJAY_FW_UPDATE_INITIAL_NEUTRAL&#160;</td><td class="fielddoc"><p>Corresponds to the "Idle" State and "Initial" Result. Shall be used when the library is initializing normally, not after a firmware update attempt. </p>
</td></tr>
<tr><td class="fieldname"><a id="a528128908ddd63124b2722950f8f4791a18caf6ef11603ba8d6758b20e1862352"></a>ANJAY_FW_UPDATE_INITIAL_SUCCESS&#160;</td><td class="fielddoc"><p>Corresponds to the "Idle" State and "Firmware updated successfully" Result. Shall be used when the device has just rebooted after successfully updating the firmware. </p>
</td></tr>
<tr><td class="fieldname"><a id="a528128908ddd63124b2722950f8f4791ab6f5d45cff4db30449341dd0fbda9373"></a>ANJAY_FW_UPDATE_INITIAL_INTEGRITY_FAILURE&#160;</td><td class="fielddoc"><p>Corresponds to the "Idle" State and "Integrity check failure" Result. Shall be used when the device has just rebooted after an unsuccessful firmware update attempt that failed due to failed integrity check of the firmware package. </p>
</td></tr>
<tr><td class="fieldname"><a id="a528128908ddd63124b2722950f8f4791a64cdc79696290cc3695fbd34e15d8276"></a>ANJAY_FW_UPDATE_INITIAL_FAILED&#160;</td><td class="fielddoc"><p>Corresponds to the "Idle" State "Firmware update failed" Result. Shall be used when the device has just rebooted after a firmware upgrade attempt that was unsuccessful for reason any other than integrity check. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a058f05510e5b22fbdf53466a03cc6d38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a058f05510e5b22fbdf53466a03cc6d38">&#9670;&nbsp;</a></span>anjay_fw_update_install()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int anjay_fw_update_install </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="core_8h.html#a6c9664a3b0c2d5629c9639dce7b1dbfb">anjay_t</a> *&#160;</td>
          <td class="paramname"><em>anjay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structanjay__fw__update__handlers__t.html">anjay_fw_update_handlers_t</a> *&#160;</td>
          <td class="paramname"><em>handlers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structanjay__fw__update__initial__state__t.html">anjay_fw_update_initial_state_t</a> *&#160;</td>
          <td class="paramname"><em>initial_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Installs the Firmware Update object in an Anjay object.</p>
<p>The Firmware Update module does not require explicit cleanup; all resources will be automatically freed up during the call to <a class="el" href="core_8h.html#a243f18f976bca57b5a7b0714bfb99095">anjay_delete</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">anjay</td><td>Anjay object for which the Firmware Update Object is installed.</td></tr>
    <tr><td class="paramname">handlers</td><td>Pointer to a set of handler functions that handle the platform-specific part of firmware update process. Note: Contents of the structure are NOT copied, so it needs to remain valid for the lifetime of the object.</td></tr>
    <tr><td class="paramname">user_arg</td><td>Opaque user pointer that will be passed as the first argument to handler functions.</td></tr>
    <tr><td class="paramname">initial_state</td><td>Information about the state to initialize the Firmware Update object in. It is intended to be used after either an orderly reboot caused by a firmware update attempt to report the update result, or by an unexpected reboot in the middle of the download process. If the object shall be initialized in a neutral initial state, <code>NULL</code> might be passed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, or a negative value in case of error. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e05d7e2b1ecd646af5bb94391405f3b5.html">modules</a></li><li class="navelem"><a class="el" href="dir_aa01a8637aa49ffd335cbf2b76be9ae7.html">fw_update</a></li><li class="navelem"><a class="el" href="dir_cab12f08c791e675dbf693fef0b9538e.html">include_public</a></li><li class="navelem"><a class="el" href="dir_efd9491ebce6ae5f6323788230eee553.html">anjay</a></li><li class="navelem"><a class="el" href="fw__update_8h.html">fw_update.h</a></li>
    <li class="footer">Generated on Mon Nov 20 2017 13:10:35 for anjay by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
