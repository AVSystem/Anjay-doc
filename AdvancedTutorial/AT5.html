

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.5. Retransmissions &amp; response caching &mdash; Anjay 1.13.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.6. Network error handling" href="AT6.html" />
    <link rel="prev" title="5.4. Access Control in multi-server environment" href="AT4.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Anjay
          

          
          </a>

          
            
            
              <div class="version">
                1.13.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LwM2M.html">2. OMA LwM2M - Brief description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiling_client_applications.html">3. Compiling client applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BasicTutorial.html">4. Basic tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../AdvancedTutorial.html">5. Advanced tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AT1.html">5.1. Attribute storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="AT2.html">5.2. Persistence support</a></li>
<li class="toctree-l2"><a class="reference internal" href="AT3.html">5.3. DTLS support</a></li>
<li class="toctree-l2"><a class="reference internal" href="AT4.html">5.4. Access Control in multi-server environment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.5. Retransmissions &amp; response caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="AT6.html">5.6. Network error handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="AT7.html">5.7. Other library features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">6. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PortingGuideForNonPOSIXPlatforms.html">7. Porting guide for non-POSIX platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Commercial_support.html">8. Commercial support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anjay</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../AdvancedTutorial.html">5. Advanced tutorial</a> &raquo;</li>
        
      <li>5.5. Retransmissions &amp; response caching</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/AdvancedTutorial/AT5.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="retransmissions-response-caching">
<h1>5.5. Retransmissions &amp; response caching<a class="headerlink" href="#retransmissions-response-caching" title="Permalink to this headline">¶</a></h1>
<p>Due to potential network instability, the need to retransmit a message
between a Client and a Server may sometimes occur. Detecting retransmissions
is especially important if the operation has some observable side effects.</p>
<div class="section" id="motivational-examples">
<h2>5.5.1. Motivational examples<a class="headerlink" href="#motivational-examples" title="Permalink to this headline">¶</a></h2>
<p>Imagine an LwM2M Object with a numeric, executable Resource, whose value is
incremented every time an LwM2M Server performs Execute on it. Now, consider
the following scenario:</p>
<ul class="simple">
<li>the LwM2M Server performs an Execute on this specific Resource,</li>
<li>the LwM2M Client receives the request, bumps the value, and sends a response,</li>
<li>the response is lost due to unfortunate network conditions,</li>
<li>the LwM2M Server attempts to increment the Resource again (sending exactly
the same Execute request as before),</li>
<li>the LwM2M Client receives the request.</li>
</ul>
<p>LwM2M Client obtained both requests, and if it was unable to classify the
second one as a retransmission of the first, the resource would be incremented
twice, even though it would make much more sense to increment it just once.
On the other hand, caching the response, and detecting a retransmission,
would improve Client-Server communication integrity by preventing this
from happening.</p>
<p>Another scenario could be that the response is computationally expensive
(and time-consuming) to generate. In this case caching mechanism would
yield measurable performance benefits.</p>
</div>
<div class="section" id="caching-mechanism">
<h2>5.5.2. Caching mechanism<a class="headerlink" href="#caching-mechanism" title="Permalink to this headline">¶</a></h2>
<p>Anjay provides a built-in message cache (as an optional feature), that can be
(and is, by default) enabled at a compile time (via
<code class="docutils literal notranslate"><span class="pre">WITH_AVS_COAP_MESSAGE_CACHE</span></code> CMake option).</p>
<p>When the request is received, Anjay checks if there exists an appropriate
response to it in the cache already. In case there is one, it is
retransmitted. Otherwise Anjay processes the request as usual, in the end
placing response in the cache for future use.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Cached response, matching a specific CoAP Request is identified by the
following triplet:</p>
<blockquote class="last">
<div><ul class="simple">
<li>CoAP Message Token,</li>
<li>CoAP Message ID,</li>
<li>Server endpoint name (host and port).</li>
</ul>
</div></blockquote>
</div>
<p>Every response in the cache sits there for at most <code class="docutils literal notranslate"><span class="pre">MAX_TRANSMIT_SPAN</span></code>
as defined in <a class="reference external" href="https://tools.ietf.org/html/rfc7252">RFC7252</a>, in
<a class="reference external" href="https://tools.ietf.org/html/rfc7252#section-4.8.2">Section 4.8.2.  Time Values Derived from Transmission Parameters</a>, and after that time
it is automatically removed.</p>
</div>
<div class="section" id="cache-size">
<h2>5.5.3. Cache size<a class="headerlink" href="#cache-size" title="Permalink to this headline">¶</a></h2>
<p>The size of the cache is specified at Anjay instantiation time by setting
<code class="docutils literal notranslate"><span class="pre">anjay_configuration_t::msg_cache_size</span></code> to a non-zero value (zero disables
any caching). This limits the number of bytes used to store cached responses.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The cache size limit is global for all Servers - i.e. all responses,
to all Servers are stored within a single cache.</p>
</div>
</div>
<div class="section" id="limitations">
<h2>5.5.4. Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>If a response is too big to fit into the cache, it is <strong>not cached</strong>,</li>
<li>If a response would fit into the cache, but the cache is currently full,
responses (starting from the oldest) are <strong>dropped</strong> from the cache (even if
they are still considered valid in terms of mentioned <code class="docutils literal notranslate"><span class="pre">MAX_TRANSMIT_SPAN</span></code>),
till the new response fits.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="AT6.html" class="btn btn-neutral float-right" title="5.6. Network error handling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="AT4.html" class="btn btn-neutral" title="5.4. Access Control in multi-server environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, AVSystem.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.13.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>